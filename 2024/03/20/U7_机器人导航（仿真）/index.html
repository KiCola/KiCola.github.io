<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>U7_机器人导航（仿真） | In Zero's World</title><meta name="author" content="Zero"><meta name="copyright" content="Zero"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="第 7 章 机器人导航(仿真)导航是机器人系统中最重要的模块之一，比如现在较为流行的服务型室内机器人，就是依赖于机器人导航来实现室内自主移动的，本章主要就是介绍仿真环境下的导航实现，主要内容有:  导航相关概念 导航实现:机器人建图(SLAM)、地图服务、定位、路径规划….以可视化操作为主。 导航消息:了解地图、里程计、雷达、摄像头等相关消息格式。  预期达成的学习目标:  了解导航模块中的组成部">
<meta property="og:type" content="article">
<meta property="og:title" content="U7_机器人导航（仿真）">
<meta property="og:url" content="http://inzeroworld.com.cn/2024/03/20/U7_%E6%9C%BA%E5%99%A8%E4%BA%BA%E5%AF%BC%E8%88%AA%EF%BC%88%E4%BB%BF%E7%9C%9F%EF%BC%89/index.html">
<meta property="og:site_name" content="In Zero&#39;s World">
<meta property="og:description" content="第 7 章 机器人导航(仿真)导航是机器人系统中最重要的模块之一，比如现在较为流行的服务型室内机器人，就是依赖于机器人导航来实现室内自主移动的，本章主要就是介绍仿真环境下的导航实现，主要内容有:  导航相关概念 导航实现:机器人建图(SLAM)、地图服务、定位、路径规划….以可视化操作为主。 导航消息:了解地图、里程计、雷达、摄像头等相关消息格式。  预期达成的学习目标:  了解导航模块中的组成部">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://s2.loli.net/2024/01/01/6KrPmZeSJzgTxFC.png">
<meta property="article:published_time" content="2024-03-20T12:10:40.000Z">
<meta property="article:modified_time" content="2024-03-20T12:55:14.498Z">
<meta property="article:author" content="Zero">
<meta property="article:tag" content="ROS">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://s2.loli.net/2024/01/01/6KrPmZeSJzgTxFC.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://inzeroworld.com.cn/2024/03/20/U7_%E6%9C%BA%E5%99%A8%E4%BA%BA%E5%AF%BC%E8%88%AA%EF%BC%88%E4%BB%BF%E7%9C%9F%EF%BC%89/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=4.12.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.32/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":50,"languages":{"author":"作者: Zero","link":"链接: ","source":"来源: In Zero's World","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.11.0/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'U7_机器人导航（仿真）',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-03-20 20:55:14'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.0.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://s2.loli.net/2024/03/06/DdFmuoWIlGbg6fU.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">33</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">5</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">4</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/photo/"><i class="fa-fw fa fa-file-photo-o"></i><span> Photo</span></a></li><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li><li><a class="site-page child" href="/animations/"><i class="fa-fw fas fa-film"></i><span> Animation</span></a></li><li><a class="site-page child" href="/games/"><i class="fa-fw fas fa-gamepad"></i><span> Game</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://s2.loli.net/2024/01/01/6KrPmZeSJzgTxFC.png')"><nav id="nav"><span id="blog-info"><a href="/" title="In Zero's World"><img class="site-icon" src="https://cdn.pixabay.com/photo/2017/03/08/14/20/flat-2126879_960_720.png"/><span class="site-name">In Zero's World</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/photo/"><i class="fa-fw fa fa-file-photo-o"></i><span> Photo</span></a></li><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li><li><a class="site-page child" href="/animations/"><i class="fa-fw fas fa-film"></i><span> Animation</span></a></li><li><a class="site-page child" href="/games/"><i class="fa-fw fas fa-gamepad"></i><span> Game</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">U7_机器人导航（仿真）</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-03-20T12:10:40.000Z" title="发表于 2024-03-20 20:10:40">2024-03-20</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-03-20T12:55:14.498Z" title="更新于 2024-03-20 20:55:14">2024-03-20</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/ROS/">ROS</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="U7_机器人导航（仿真）"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="第-7-章-机器人导航-仿真"><a href="#第-7-章-机器人导航-仿真" class="headerlink" title="第 7 章 机器人导航(仿真)"></a>第 7 章 机器人导航(仿真)</h1><p>导航是机器人系统中最重要的模块之一，比如现在较为流行的服务型室内机器人，就是依赖于机器人导航来实现室内自主移动的，本章主要就是介绍仿真环境下的导航实现，主要内容有:</p>
<ul>
<li>导航相关概念</li>
<li>导航实现:机器人建图(SLAM)、地图服务、定位、路径规划….以可视化操作为主。</li>
<li>导航消息:了解地图、里程计、雷达、摄像头等相关消息格式。</li>
</ul>
<p>预期达成的学习目标:</p>
<ul>
<li>了解导航模块中的组成部分以及相关概念</li>
<li>能够在仿真环境下独立完成机器人导航</li>
</ul>
<p><strong>案例演示:</strong></p>
<p>SLAM建图</p>
<p><img src="/U7_%E6%9C%BA%E5%99%A8%E4%BA%BA%E5%AF%BC%E8%88%AA%EF%BC%88%E4%BB%BF%E7%9C%9F%EF%BC%89%5C%E5%AF%BC%E8%88%AA.gif" alt="img"></p>
<p>定位</p>


<p>导航实现</p>


<h2 id="7-1-概述"><a href="#7-1-概述" class="headerlink" title="7.1 概述"></a>7.1 概述</h2><h4 id="1-概念"><a href="#1-概念" class="headerlink" title="1.概念"></a>1.概念</h4><p>在ROS中机器人导航(Navigation)由多个功能包组合实现，ROS 中又称之为导航功能包集，关于导航模块，官方介绍如下:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">一个二维导航堆栈，它接收来自里程计、传感器流和目标姿态的信息，并输出发送到移动底盘的安全速度命令。</span><br></pre></td></tr></table></figure>

<p>更通俗的讲: 导航其实就是机器人自主的从 A 点移动到 B 点的过程。</p>


<h4 id="2-作用"><a href="#2-作用" class="headerlink" title="2.作用"></a>2.作用</h4><p>秉着”不重复发明轮子”的原则，ROS 中导航相关的功能包集为机器人导航提供了一套通用的实现，开发者不再需要关注于导航算法、硬件交互…  等偏复杂、偏底层的实现，这些实现都由更专业的研发人员管理、迭代和维护，开发者可以更专注于上层功能，而对于导航功能的调用，只需要根据自身机器人相关参数合理设置各模块的配置文件即可，当然，如果有必要，也可以基于现有的功能包二次开发实现一些定制化需求，这样可以大大提高研发效率，缩短产品落地时间。总而言之，对于一般开发者而言，ROS 的导航功能包集优势如下:</p>
<ul>
<li>安全: 由专业团队开发和维护</li>
<li>功能: 功能更稳定且全面</li>
<li>高效: 解放开发者，让开发者更专注于上层功能实现</li>
</ul>
<hr>
<p><strong>另请参考:</strong></p>
<ul>
<li><a target="_blank" rel="noopener" href="http://wiki.ros.org/navigation">http://wiki.ros.org/navigation</a></li>
</ul>
<h3 id="7-1-1导航模块简介"><a href="#7-1-1导航模块简介" class="headerlink" title="7.1.1导航模块简介"></a>7.1.1导航模块简介</h3><p>机器人是如何实现导航的呢？或换言之，机器人是如何从 A 点移动到 B 点呢？ROS 官方为了提供了一张导航功能包集的图示,该图中囊括了 ROS 导航的一些关键技术:</p>
<p>假定我们已经以特定方式配置机器人，导航功能包集将使其可以运动。上图概述了这种配置方式。白色的部分是必须且已实现的组件，灰色的部分是可选且已实现的组件，蓝色的部分是必须为每一个机器人平台创建的组件。</p>
<p>总结下来，涉及的关键技术有如下五点:</p>
<ol>
<li>全局地图</li>
<li>自身定位</li>
<li>路径规划</li>
<li>运动控制</li>
<li>环境感知</li>
</ol>
<p>机器人导航实现与无人驾驶类似，关键技术也是由上述五点组成，只是无人驾驶是基于室外的，而我们当前介绍的机器人导航更多是基于室内的。</p>
<h4 id="1-全局地图"><a href="#1-全局地图" class="headerlink" title="1.全局地图"></a>1.全局地图</h4><p>在现实生活中，当我们需要实现导航时，可能会首先参考一张全局性质的地图，然后根据地图来确定自身的位置、目的地位置，并且也会根据地图显示来规划一条大致的路线….  对于机器人导航而言，也是如此，在机器人导航中地图是一个重要的组成元素，当然如果要使用地图，首先需要绘制地图。关于地图建模技术不断涌现，这其中有一门称之为 SLAM 的理论脱颖而出:</p>
<ol>
<li><strong>SLAM</strong>(simultaneous localization and  mapping),也称为CML (Concurrent Mapping and Localization),  即时定位与地图构建，或并发建图与定位。SLAM问题可以描述为:  机器人在未知环境中从一个未知位置开始移动,在移动过程中根据位置估计和地图进行自身定位，同时在自身定位的基础上建造增量式地图，以绘制出外部环境的完全地图。</li>
<li>在 ROS 中，较为常用的 SLAM 实现也比较多，比如: gmapping、hector_slam、cartographer、rgbdslam、ORB_SLAM ….</li>
<li>当然如果要完成 SLAM ，机器人必须要具备感知外界环境的能力，尤其是要具备获取周围环境深度信息的能力。感知的实现需要依赖于传感器，比如: 激光雷达、摄像头、RGB-D摄像头…</li>
<li>SLAM 可以用于地图生成，而生成的地图还需要被保存以待后续使用，在 ROS 中保存地图的功能包是 map_server</li>
</ol>
<p>另外注意: SLAM 虽然是机器人导航的重要技术之一，但是 二者并不等价，确切的讲，SLAM 只是实现地图构建和即时定位。</p>
<h4 id="2-自身定位"><a href="#2-自身定位" class="headerlink" title="2.自身定位"></a>2.自身定位</h4><p>导航伊始和导航过程中，机器人都需要确定当前自身的位置，如果在室外，那么 GPS 是一个不错的选择，而如果室内、隧道、地下或一些特殊的屏蔽  GPS 信号的区域，由于 GPS 信号弱化甚至完全不可用，那么就必须另辟蹊径了，比如前面的 SLAM 就可以实现自身定位，除此之外，ROS  中还提供了一个用于定位的功能包: amcl</p>
<p><strong>amcl</strong>(adaptiveMonteCarloLocalization)自适应的蒙特卡洛定位,是用于2D移动机器人的概率定位系统。它实现了自适应（或KLD采样）蒙特卡洛定位方法，该方法使用粒子过滤器根据已知地图跟踪机器人的姿态。</p>
<h4 id="3-路径规划"><a href="#3-路径规划" class="headerlink" title="3.路径规划"></a>3.路径规划</h4><p>导航就是机器人从A点运动至B点的过程，在这一过程中，机器人需要根据目标位置计算全局运动路线，并且在运动过程中，还需要时时根据出现的一些动态障碍物调整运动路线，直至到达目标点，该过程就称之为路径规划。在 ROS 中提供了 move_base 包来实现路径规则,该功能包主要由两大规划器组成:</p>
<ol>
<li><p>全局路径规划(gloable_planner)</p>
<p>根据给定的目标点和全局地图实现总体的路径规划，使用 Dijkstra 或 A* 算法进行全局路径规划，计算最优路线，作为全局路线</p>
</li>
<li><p>本地时时规划(local_planner)</p>
<p>在实际导航过程中，机器人可能无法按照给定的全局最优路线运行，比如:机器人在运行中，可能会随时出现一定的障碍物…  本地规划的作用就是使用一定算法(Dynamic Window Approaches)  来实现障碍物的规避，并选取当前最优路径以尽量符合全局最优路径</p>
</li>
</ol>
<p>全局路径规划与本地路径规划是相对的，全局路径规划侧重于全局、宏观实现，而本地路径规划侧重与当前、微观实现。</p>
<h4 id="4-运动控制"><a href="#4-运动控制" class="headerlink" title="4.运动控制"></a>4.运动控制</h4><p>导航功能包集假定它可以通过话题”cmd_vel”发布<code>geometry_msgs/Twist</code>类型的消息，这个消息基于机器人的基座坐标系，它传递的是运动命令。这意味着必须有一个节点订阅”cmd_vel”话题， 将该话题上的速度命令转换为电机命令并发送。</p>
<h4 id="5-环境感知"><a href="#5-环境感知" class="headerlink" title="5.环境感知"></a>5.环境感知</h4><p>感知周围环境信息，比如: 摄像头、激光雷达、编码器…，摄像头、激光雷达可以用于感知外界环境的深度信息，编码器可以感知电机的转速信息，进而可以获取速度信息并生成里程计信息。</p>
<p>在导航功能包集中，环境感知也是一重要模块实现，它为其他模块提供了支持。其他模块诸如: SLAM、amcl、move_base 都需要依赖于环境感知。</p>
<h3 id="7-1-2-导航之坐标系"><a href="#7-1-2-导航之坐标系" class="headerlink" title="7.1.2 导航之坐标系"></a>7.1.2 导航之坐标系</h3><h4 id="1-简介"><a href="#1-简介" class="headerlink" title="1.简介"></a>1.简介</h4><p>定位是导航中的重要实现之一，所谓定位，就是参考某个坐标系(比如:以机器人的出发点为原点创建坐标系)在该坐标系中标注机器人。定位原理看似简单，但是这个这个坐标系不是客观存在的，我们也无法以上帝视角确定机器人的位姿，定位实现需要依赖于机器人自身，机器人需要逆向推导参考系原点并计算坐标系相对关系，该过程实现常用方式有两种:</p>
<ul>
<li>通过里程计定位:时时收集机器人的速度信息计算并发布机器人坐标系与父级参考系的相对关系。</li>
<li>通过传感器定位:通过传感器收集外界环境信息通过匹配计算并发布机器人坐标系与父级参考系的相对关系。</li>
</ul>
<p>两种方式在导航中都会经常使用。</p>
<h4 id="2-特点"><a href="#2-特点" class="headerlink" title="2.特点"></a>2.特点</h4><p>两种定位方式都有各自的优缺点。</p>
<p>里程计定位:</p>
<ul>
<li>优点:里程计定位信息是连续的，没有离散的跳跃。</li>
<li>缺点:里程计存在累计误差，不利于长距离或长期定位。</li>
</ul>
<p>传感器定位:</p>
<ul>
<li>优点:比里程计定位更精准；</li>
<li>缺点:传感器定位会出现跳变的情况，且传感器定位在标志物较少的环境下，其定位精度会大打折扣。</li>
</ul>
<p>两种定位方式优缺点互补，应用时一般二者结合使用。</p>
<h4 id="3-坐标系变换"><a href="#3-坐标系变换" class="headerlink" title="3.坐标系变换"></a>3.坐标系变换</h4><p>上述两种定位实现中，机器人坐标系一般使用机器人模型中的根坐标系(base_link 或  base_footprint)，里程计定位时，父级坐标系一般称之为 odom，如果通过传感器定位，父级参考系一般称之为  map。当二者结合使用时，map 和 odom  都是机器人模型根坐标系的父级，这是不符合坐标变换中”单继承”的原则的，所以，一般会将转换关系设置为: map -&gt; doom -&gt;  base_link 或 base_footprint。</p>
<h3 id="7-1-3导航条件说明"><a href="#7-1-3导航条件说明" class="headerlink" title="7.1.3导航条件说明"></a>7.1.3导航条件说明</h3><p>导航实现，在硬件和软件方面是由一定要求的，需要提前准备。</p>
<h4 id="1-硬件"><a href="#1-硬件" class="headerlink" title="1.硬件"></a>1.硬件</h4><p>虽然导航功能包集被设计成尽可能的通用，在使用时仍然有三个主要的硬件限制：</p>
<ol>
<li>它是为差速驱动的轮式机器人设计的。它假设底盘受到理想的运动命令的控制并可实现预期的结果，命令的格式为：x速度分量，y速度分量，角速度(theta)分量。</li>
<li>它需要在底盘上安装一个单线激光雷达。这个激光雷达用于构建地图和定位。</li>
<li>导航功能包集是为正方形的机器人开发的，所以方形或圆形的机器人将是性能最好的。 它也可以工作在任意形状和大小的机器人上，但是较大的机器人将很难通过狭窄的空间。</li>
</ol>
<h4 id="2-软件"><a href="#2-软件" class="headerlink" title="2.软件"></a>2.软件</h4><p>导航功能实现之前，需要搭建一些软件环境:</p>
<ol>
<li><p>毋庸置疑的，必须先要安装 ROS</p>
</li>
<li><p>当前导航基于仿真环境，先保证上一章的机器人系统仿真可以正常执行</p>
<p>在仿真环境下，机器人可以正常接收 &#x2F;cmd_vel 消息，并发布里程计消息，传感器消息发布也正常，也即导航模块中的运动控制和环境感知实现完毕</p>
</li>
</ol>
<p>后续导航实现中，我们主要关注于: 使用 SLAM 绘制地图、地图服务、自身定位与路径规划。</p>
<h2 id="7-2-导航实现"><a href="#7-2-导航实现" class="headerlink" title="7.2 导航实现"></a>7.2 导航实现</h2><p>本节内容主要介绍导航的完整性实现，旨在掌握机器人导航的基本流程，该章涉及的主要内容如下:</p>
<ul>
<li>SLAM建图(选用较为常见的gmapping)</li>
<li>地图服务(可以保存和重现地图)</li>
<li>机器人定位</li>
<li>路径规划</li>
<li>上述流程介绍完毕，还会对功能进一步集成实现探索式的SLAM建图。</li>
</ul>
<hr>
<p><strong>准备工作</strong></p>
<p>请先安装相关的ROS功能包:</p>
<ul>
<li>安装 gmapping 包(用于构建地图):<code>sudo apt install ros-&lt;ROS版本&gt;-gmapping</code></li>
<li>安装地图服务包(用于保存与读取地图):<code>sudo apt install ros-&lt;ROS版本&gt;-map-server</code></li>
<li>安装 navigation 包(用于定位以及路径规划):<code>sudo apt install ros-&lt;ROS版本&gt;-navigation</code></li>
</ul>
<p>新建功能包，并导入依赖: gmapping map_server amcl move_base</p>
<h3 id="7-2-1-导航实现01-SLAM建图"><a href="#7-2-1-导航实现01-SLAM建图" class="headerlink" title="7.2.1 导航实现01_SLAM建图"></a>7.2.1 导航实现01_SLAM建图</h3><p>SLAM算法有多种，当前我们选用gmapping，后续会再介绍其他几种常用的SLAM实现。</p>
<h4 id="1-gmapping简介"><a href="#1-gmapping简介" class="headerlink" title="1.gmapping简介"></a>1.gmapping简介</h4><p>gmapping 是ROS开源社区中较为常用且比较成熟的SLAM算法之一，gmapping可以根据移动机器人里程计数据和激光雷达数据来绘制二维的栅格地图，对应的，gmapping对硬件也有一定的要求:</p>
<ul>
<li>该移动机器人可以发布里程计消息</li>
<li>机器人需要发布雷达消息(该消息可以通过水平固定安装的雷达发布，或者也可以将深度相机消息转换成雷达消息)</li>
</ul>
<p>关于里程计与雷达数据，仿真环境中可以正常获取的，不再赘述，栅格地图如案例所示。</p>
<p>gmapping 安装前面也有介绍，命令如下:</p>
<blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install ros-&lt;ROS版本&gt;-gmapping</span><br></pre></td></tr></table></figure>
</blockquote>
<h4 id="2-gmapping节点说明"><a href="#2-gmapping节点说明" class="headerlink" title="2.gmapping节点说明"></a>2.gmapping节点说明</h4><p>gmapping 功能包中的核心节点是:slam_gmapping。为了方便调用，需要先了解该节点订阅的话题、发布的话题、服务以及相关参数。</p>
<h5 id="2-1订阅的Topic"><a href="#2-1订阅的Topic" class="headerlink" title="2.1订阅的Topic"></a>2.1订阅的Topic</h5><p>tf (tf&#x2F;tfMessage)</p>
<ul>
<li>用于雷达、底盘与里程计之间的坐标变换消息。</li>
</ul>
<p>scan(sensor_msgs&#x2F;LaserScan)</p>
<ul>
<li>SLAM所需的雷达信息。</li>
</ul>
<h5 id="2-2发布的Topic"><a href="#2-2发布的Topic" class="headerlink" title="2.2发布的Topic"></a>2.2发布的Topic</h5><p>map_metadata(nav_msgs&#x2F;MapMetaData)</p>
<ul>
<li>地图元数据，包括地图的宽度、高度、分辨率等，该消息会固定更新。</li>
</ul>
<p>map(nav_msgs&#x2F;OccupancyGrid)</p>
<ul>
<li>地图栅格数据，一般会在rviz中以图形化的方式显示。</li>
</ul>
<p>~entropy(std_msgs&#x2F;Float64)</p>
<ul>
<li>机器人姿态分布熵估计(值越大，不确定性越大)。</li>
</ul>
<h5 id="2-3服务"><a href="#2-3服务" class="headerlink" title="2.3服务"></a>2.3服务</h5><p>dynamic_map(nav_msgs&#x2F;GetMap)</p>
<ul>
<li>用于获取地图数据。</li>
</ul>
<h5 id="2-4参数"><a href="#2-4参数" class="headerlink" title="2.4参数"></a>2.4参数</h5><p>~base_frame(string, default:”base_link”)</p>
<ul>
<li>机器人基坐标系。</li>
</ul>
<p>~map_frame(string, default:”map”)</p>
<ul>
<li>地图坐标系。</li>
</ul>
<p>~odom_frame(string, default:”odom”)</p>
<ul>
<li>里程计坐标系。</li>
</ul>
<p>~map_update_interval(float, default: 5.0)</p>
<ul>
<li>地图更新频率，根据指定的值设计更新间隔。</li>
</ul>
<p>~maxUrange(float, default: 80.0)</p>
<ul>
<li>激光探测的最大可用范围(超出此阈值，被截断)。</li>
</ul>
<p>~maxRange(float)</p>
<ul>
<li>激光探测的最大范围。</li>
</ul>
<p>…. 参数较多，上述是几个较为常用的参数，其他参数介绍可参考官网。</p>
<h5 id="2-5所需的坐标变换"><a href="#2-5所需的坐标变换" class="headerlink" title="2.5所需的坐标变换"></a>2.5所需的坐标变换</h5><p>雷达坐标系→基坐标系</p>
<ul>
<li>一般由 robot_state_publisher 或 static_transform_publisher 发布。</li>
</ul>
<p>基坐标系→里程计坐标系</p>
<ul>
<li>一般由里程计节点发布。</li>
</ul>
<h5 id="2-6发布的坐标变换"><a href="#2-6发布的坐标变换" class="headerlink" title="2.6发布的坐标变换"></a>2.6发布的坐标变换</h5><p>地图坐标系→里程计坐标系</p>
<ul>
<li>地图到里程计坐标系之间的变换。</li>
</ul>
<h4 id="3-gmapping使用"><a href="#3-gmapping使用" class="headerlink" title="3.gmapping使用"></a>3.gmapping使用</h4><h5 id="3-1编写gmapping节点相关launch文件"><a href="#3-1编写gmapping节点相关launch文件" class="headerlink" title="3.1编写gmapping节点相关launch文件"></a>3.1编写gmapping节点相关launch文件</h5><p>launch文件编写可以参考 github 的演示 launch文件：<a target="_blank" rel="noopener" href="https://github.com/ros-perception/slam_gmapping/blob/melodic-devel/gmapping/launch/slam_gmapping_pr2.launch">https://github.com/ros-perception/slam_gmapping/blob/melodic-devel/gmapping/launch/slam_gmapping_pr2.launch</a></p>
<p>复制并修改如下:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">launch</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;use_sim_time&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">&quot;gmapping&quot;</span> <span class="attr">type</span>=<span class="string">&quot;slam_gmapping&quot;</span> <span class="attr">name</span>=<span class="string">&quot;slam_gmapping&quot;</span> <span class="attr">output</span>=<span class="string">&quot;screen&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">remap</span> <span class="attr">from</span>=<span class="string">&quot;scan&quot;</span> <span class="attr">to</span>=<span class="string">&quot;scan&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;base_frame&quot;</span> <span class="attr">value</span>=<span class="string">&quot;base_footprint&quot;</span>/&gt;</span><span class="comment">&lt;!--底盘坐标系--&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;odom_frame&quot;</span> <span class="attr">value</span>=<span class="string">&quot;odom&quot;</span>/&gt;</span> <span class="comment">&lt;!--里程计坐标系--&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;map_update_interval&quot;</span> <span class="attr">value</span>=<span class="string">&quot;5.0&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;maxUrange&quot;</span> <span class="attr">value</span>=<span class="string">&quot;16.0&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;sigma&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0.05&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;kernelSize&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;lstep&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0.05&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;astep&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0.05&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;iterations&quot;</span> <span class="attr">value</span>=<span class="string">&quot;5&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;lsigma&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0.075&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;ogain&quot;</span> <span class="attr">value</span>=<span class="string">&quot;3.0&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;lskip&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;srr&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0.1&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;srt&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0.2&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;str&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0.1&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;stt&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0.2&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;linearUpdate&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1.0&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;angularUpdate&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0.5&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;temporalUpdate&quot;</span> <span class="attr">value</span>=<span class="string">&quot;3.0&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;resampleThreshold&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0.5&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;particles&quot;</span> <span class="attr">value</span>=<span class="string">&quot;30&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;xmin&quot;</span> <span class="attr">value</span>=<span class="string">&quot;-50.0&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;ymin&quot;</span> <span class="attr">value</span>=<span class="string">&quot;-50.0&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;xmax&quot;</span> <span class="attr">value</span>=<span class="string">&quot;50.0&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;ymax&quot;</span> <span class="attr">value</span>=<span class="string">&quot;50.0&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;delta&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0.05&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;llsamplerange&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0.01&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;llsamplestep&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0.01&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;lasamplerange&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0.005&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;lasamplestep&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0.005&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">node</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">&quot;joint_state_publisher&quot;</span> <span class="attr">name</span>=<span class="string">&quot;joint_state_publisher&quot;</span> <span class="attr">type</span>=<span class="string">&quot;joint_state_publisher&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">&quot;robot_state_publisher&quot;</span> <span class="attr">name</span>=<span class="string">&quot;robot_state_publisher&quot;</span> <span class="attr">type</span>=<span class="string">&quot;robot_state_publisher&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">&quot;rviz&quot;</span> <span class="attr">type</span>=<span class="string">&quot;rviz&quot;</span> <span class="attr">name</span>=<span class="string">&quot;rviz&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 可以保存 rviz 配置并后期直接使用--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    &lt;node pkg=&quot;rviz&quot; type=&quot;rviz&quot; name=&quot;rviz&quot; args=&quot;-d $(find my_nav_sum)/rviz/gmapping.rviz&quot;/&gt;</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">launch</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>关键代码解释：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">remap</span> <span class="attr">from</span>=<span class="string">&quot;scan&quot;</span> <span class="attr">to</span>=<span class="string">&quot;scan&quot;</span>/&gt;</span><span class="comment">&lt;!-- 雷达话题 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;base_frame&quot;</span> <span class="attr">value</span>=<span class="string">&quot;base_footprint&quot;</span>/&gt;</span><span class="comment">&lt;!--底盘坐标系--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;odom_frame&quot;</span> <span class="attr">value</span>=<span class="string">&quot;odom&quot;</span>/&gt;</span> <span class="comment">&lt;!--里程计坐标系--&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="3-2执行"><a href="#3-2执行" class="headerlink" title="3.2执行"></a>3.2执行</h5><p>1.先启动 Gazebo 仿真环境(此过程略)</p>
<p>2.然后再启动地图绘制的 launch 文件:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">roslaunch 包名 launch文件名</span><br></pre></td></tr></table></figure>

<p>3.启动键盘键盘控制节点，用于控制机器人运动建图</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rosrun teleop_twist_keyboard teleop_twist_keyboard.py</span><br></pre></td></tr></table></figure>

<p>4.在 rviz 中添加组件，显示栅格地图最后，就可以通过键盘控制gazebo中的机器人运动，同时，在rviz中可以显示gmapping发布的栅格地图数据了，下一步，还需要将地图单独保存。</p>
<hr>
<p><strong>另请参考:</strong></p>
<ul>
<li><a target="_blank" rel="noopener" href="http://wiki.ros.org/gmapping">http://wiki.ros.org/gmapping</a></li>
</ul>
<h3 id="7-2-2-导航实现02-地图服务"><a href="#7-2-2-导航实现02-地图服务" class="headerlink" title="7.2.2 导航实现02_地图服务"></a>7.2.2 导航实现02_地图服务</h3><p>上一节我们已经实现通过gmapping的构建地图并在rviz中显示了地图，不过，上一节中地图数据是保存在内存中的，当节点关闭时，数据也会被一并释放，我们需要将栅格地图序列化到的磁盘以持久化存储，后期还要通过反序列化读取磁盘的地图数据再执行后续操作。在ROS中，地图数据的序列化与反序列化可以通过 map_server 功能包实现。</p>
<h4 id="1-map-server简介"><a href="#1-map-server简介" class="headerlink" title="1.map_server简介"></a>1.map_server简介</h4><p>map_server功能包中提供了两个节点:  map_saver 和 map_server，前者用于将栅格地图保存到磁盘，后者读取磁盘的栅格地图并以服务的方式提供出去。</p>
<p>map_server安装前面也有介绍，命令如下:</p>
<blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install ros-&lt;ROS版本&gt;-map-server</span><br></pre></td></tr></table></figure>
</blockquote>
<h4 id="2-map-server使用之地图保存节点-map-saver"><a href="#2-map-server使用之地图保存节点-map-saver" class="headerlink" title="2.map_server使用之地图保存节点(map_saver)"></a>2.map_server使用之地图保存节点(map_saver)</h4><h5 id="2-1map-saver节点说明"><a href="#2-1map-saver节点说明" class="headerlink" title="2.1map_saver节点说明"></a>2.1map_saver节点说明</h5><p><strong>订阅的topic:</strong></p>
<p>map(nav_msgs&#x2F;OccupancyGrid)</p>
<ul>
<li>订阅此话题用于生成地图文件。</li>
</ul>
<h5 id="2-2地图保存launch文件"><a href="#2-2地图保存launch文件" class="headerlink" title="2.2地图保存launch文件"></a>2.2地图保存launch文件</h5><p>地图保存的语法比较简单，编写一个launch文件，内容如下:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">launch</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">arg</span> <span class="attr">name</span>=<span class="string">&quot;filename&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$(find mycar_nav)/map/nav&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">name</span>=<span class="string">&quot;map_save&quot;</span> <span class="attr">pkg</span>=<span class="string">&quot;map_server&quot;</span> <span class="attr">type</span>=<span class="string">&quot;map_saver&quot;</span> <span class="attr">args</span>=<span class="string">&quot;-f $(arg filename)&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">launch</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>其中 mymap 是指地图的保存路径以及保存的文件名称。</p>
<p>SLAM建图完毕后，执行该launch文件即可。</p>
<p>测试:</p>
<blockquote>
<p>首先，参考上一节，依次启动仿真环境，键盘控制节点与SLAM节点；</p>
<p>然后，通过键盘控制机器人运动并绘图；</p>
<p>最后，通过上述地图保存方式保存地图。</p>
<p>结果：在指定路径下会生成两个文件，xxx.pgm 与 xxx.yaml</p>
</blockquote>
<h5 id=""><a href="#" class="headerlink" title=""></a></h5><h5 id="2-3-保存结果解释"><a href="#2-3-保存结果解释" class="headerlink" title="2.3 保存结果解释"></a>2.3 保存结果解释</h5>

<p>xxx.pgm 本质是一张图片，直接使用图片查看程序即可打开。</p>
<p>xxx.yaml 保存的是地图的元数据信息，用于描述图片，内容格式如下:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">image:</span> <span class="string">/home/rosmelodic/ws02_nav/src/mycar_nav/map/nav.pgm</span></span><br><span class="line"><span class="attr">resolution:</span> <span class="number">0.050000</span></span><br><span class="line"><span class="attr">origin:</span> [<span class="number">-50.000000</span>, <span class="number">-50.000000</span>, <span class="number">0.000000</span>]</span><br><span class="line"><span class="attr">negate:</span> <span class="number">0</span></span><br><span class="line"><span class="attr">occupied_thresh:</span> <span class="number">0.65</span></span><br><span class="line"><span class="attr">free_thresh:</span> <span class="number">0.196</span></span><br></pre></td></tr></table></figure>

<p>解释:</p>
<ul>
<li><strong>image</strong>:被描述的图片资源路径，可以是绝对路径也可以是相对路径。</li>
<li><strong>resolution</strong>: 图片分片率(单位: m&#x2F;像素)。</li>
<li><strong>origin</strong>: 地图中左下像素的二维姿势，为（x，y，偏航），偏航为逆时针旋转（偏航&#x3D; 0表示无旋转）。</li>
<li><strong>occupied_thresh</strong>: 占用概率大于此阈值的像素被视为完全占用。</li>
<li><strong>free_thresh</strong>: 占用率小于此阈值的像素被视为完全空闲。</li>
<li><strong>negate</strong>: 是否应该颠倒白色&#x2F;黑色自由&#x2F;占用的语义。</li>
</ul>
<p>map_server 中障碍物计算规则:</p>
<ol>
<li>地图中的每一个像素取值在 [0,255] 之间，白色为 255，黑色为 0，该值设为 x；</li>
<li>map_server 会将像素值作为判断是否是障碍物的依据，首先计算比例: p &#x3D; (255 - x) &#x2F; 255.0，白色为0，黑色为1(negate为true，则p &#x3D; x &#x2F; 255.0)；</li>
<li>根据步骤2计算的比例判断是否是障碍物，如果 p &gt; occupied_thresh 那么视为障碍物，如果 p &lt; free_thresh 那么视为无物。</li>
</ol>
<p>备注:</p>
<ul>
<li>图片也可以根据需求编辑。</li>
</ul>
<h4 id="3-map-server使用之地图服务-map-server"><a href="#3-map-server使用之地图服务-map-server" class="headerlink" title="3.map_server使用之地图服务(map_server)"></a>3.map_server使用之地图服务(map_server)</h4><h5 id="3-1map-server节点说明"><a href="#3-1map-server节点说明" class="headerlink" title="3.1map_server节点说明"></a>3.1map_server节点说明</h5><p><strong>发布的话题</strong></p>
<p>map_metadata（nav_msgs &#x2F; MapMetaData）</p>
<ul>
<li>发布地图元数据。</li>
</ul>
<p>map（nav_msgs &#x2F; OccupancyGrid）</p>
<ul>
<li>地图数据。</li>
</ul>
<p><strong>服务</strong></p>
<p>static_map（nav_msgs &#x2F; GetMap）</p>
<ul>
<li>通过此服务获取地图。</li>
</ul>
<p><strong>参数</strong></p>
<p>〜frame_id（字符串，默认值：“map”）</p>
<ul>
<li>地图坐标系。</li>
</ul>
<h5 id="3-2地图读取"><a href="#3-2地图读取" class="headerlink" title="3.2地图读取"></a>3.2地图读取</h5><p>通过 map_server 的 map_server 节点可以读取栅格地图数据，编写 launch 文件如下:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">launch</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 设置地图的配置文件 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">arg</span> <span class="attr">name</span>=<span class="string">&quot;map&quot;</span> <span class="attr">default</span>=<span class="string">&quot;nav.yaml&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 运行地图服务器，并且加载设置的地图--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">name</span>=<span class="string">&quot;map_server&quot;</span> <span class="attr">pkg</span>=<span class="string">&quot;map_server&quot;</span> <span class="attr">type</span>=<span class="string">&quot;map_server&quot;</span> <span class="attr">args</span>=<span class="string">&quot;$(find mycar_nav)/map/$(arg map)&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">launch</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>其中参数是地图描述文件的资源路径，执行该launch文件，该节点会发布话题:map(nav_msgs&#x2F;OccupancyGrid)</p>
<h5 id="3-3地图显示"><a href="#3-3地图显示" class="headerlink" title="3.3地图显示"></a>3.3地图显示</h5><p>在 rviz 中使用 map 组件可以显示栅格地图：</p>


<hr>
<p>另请参考:</p>
<ul>
<li><a target="_blank" rel="noopener" href="http://wiki.ros.org/map_server">http://wiki.ros.org/map_server</a></li>
</ul>
<h3 id="7-2-3-导航实现03-定位"><a href="#7-2-3-导航实现03-定位" class="headerlink" title="7.2.3 导航实现03_定位"></a>7.2.3 导航实现03_定位</h3><p>所谓定位就是推算机器人自身在全局地图中的位置，当然，SLAM中也包含定位算法实现，不过SLAM的定位是用于构建全局地图的，是属于导航开始之前的阶段，而当前定位是用于导航中，导航中，机器人需要按照设定的路线运动，通过定位可以判断机器人的实际轨迹是否符合预期。在ROS的导航功能包集navigation中提供了 amcl 功能包，用于实现导航中的机器人定位。</p>
<h4 id="1-amcl简介"><a href="#1-amcl简介" class="headerlink" title="1.amcl简介"></a>1.amcl简介</h4><p>AMCL(adaptive Monte Carlo Localization) 是用于2D移动机器人的概率定位系统，它实现了自适应（或KLD采样）蒙特卡洛定位方法，可以根据已有地图使用粒子滤波器推算机器人位置。</p>
<p>amcl已经被集成到了navigation包，navigation安装前面也有介绍，命令如下:</p>
<blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install ros-&lt;ROS版本&gt;-navigation</span><br></pre></td></tr></table></figure>
</blockquote>
<h4 id="2-amcl节点说明"><a href="#2-amcl节点说明" class="headerlink" title="2.amcl节点说明"></a>2.amcl节点说明</h4><p>amcl 功能包中的核心节点是:amcl。为了方便调用，需要先了解该节点订阅的话题、发布的话题、服务以及相关参数。</p>
<h5 id="3-1订阅的Topic"><a href="#3-1订阅的Topic" class="headerlink" title="3.1订阅的Topic"></a>3.1订阅的Topic</h5><p>scan(sensor_msgs&#x2F;LaserScan)</p>
<ul>
<li>激光雷达数据。</li>
</ul>
<p>tf(tf&#x2F;tfMessage)</p>
<ul>
<li>坐标变换消息。</li>
</ul>
<p>initialpose(geometry_msgs&#x2F;PoseWithCovarianceStamped)</p>
<ul>
<li>用来初始化粒子滤波器的均值和协方差。</li>
</ul>
<p>map(nav_msgs&#x2F;OccupancyGrid)</p>
<ul>
<li>获取地图数据。</li>
</ul>
<h5 id="3-2发布的Topic"><a href="#3-2发布的Topic" class="headerlink" title="3.2发布的Topic"></a>3.2发布的Topic</h5><p>amcl_pose(geometry_msgs&#x2F;PoseWithCovarianceStamped)</p>
<ul>
<li>机器人在地图中的位姿估计。</li>
</ul>
<p>particlecloud(geometry_msgs&#x2F;PoseArray)</p>
<ul>
<li>位姿估计集合，rviz中可以被 PoseArray 订阅然后图形化显示机器人的位姿估计集合。</li>
</ul>
<p>tf(tf&#x2F;tfMessage)</p>
<ul>
<li>发布从 odom 到 map 的转换。</li>
</ul>
<h5 id="3-3服务"><a href="#3-3服务" class="headerlink" title="3.3服务"></a>3.3服务</h5><p>global_localization(std_srvs&#x2F;Empty)</p>
<ul>
<li>初始化全局定位的服务。</li>
</ul>
<p>request_nomotion_update(std_srvs&#x2F;Empty)</p>
<ul>
<li>手动执行更新和发布更新的粒子的服务。</li>
</ul>
<p>set_map(nav_msgs&#x2F;SetMap)</p>
<ul>
<li>手动设置新地图和姿态的服务。</li>
</ul>
<h5 id="3-4调用的服务"><a href="#3-4调用的服务" class="headerlink" title="3.4调用的服务"></a>3.4调用的服务</h5><p>static_map(nav_msgs&#x2F;GetMap)</p>
<ul>
<li>调用此服务获取地图数据。</li>
</ul>
<h5 id="3-5参数"><a href="#3-5参数" class="headerlink" title="3.5参数"></a>3.5参数</h5><p>~odom_model_type(string, default:”diff”)</p>
<ul>
<li>里程计模型选择: “diff”,”omni”,”diff-corrected”,”omni-corrected” (diff 差速、omni 全向轮)</li>
</ul>
<p>~odom_frame_id(string, default:”odom”)</p>
<ul>
<li>里程计坐标系。</li>
</ul>
<p>~base_frame_id(string, default:”base_link”)</p>
<ul>
<li>机器人极坐标系。</li>
</ul>
<p>~global_frame_id(string, default:”map”)</p>
<ul>
<li>地图坐标系。</li>
</ul>
<p>…. 参数较多，上述是几个较为常用的参数，其他参数介绍可参考官网。</p>
<h5 id="3-6坐标变换"><a href="#3-6坐标变换" class="headerlink" title="3.6坐标变换"></a>3.6坐标变换</h5><p>里程计本身也是可以协助机器人定位的，不过里程计存在累计误差且一些特殊情况时(车轮打滑)会出现定位错误的情况，amcl 则可以通过估算机器人在地图坐标系下的姿态，再结合里程计提高定位准确度。</p>
<ul>
<li>里程计定位:只是通过里程计数据实现 &#x2F;odom_frame 与 &#x2F;base_frame 之间的坐标变换。</li>
<li>amcl定位: 可以提供 &#x2F;map_frame 、&#x2F;odom_frame 与 &#x2F;base_frame 之间的坐标变换。</li>
</ul>


<h4 id="3-amcl使用"><a href="#3-amcl使用" class="headerlink" title="3.amcl使用"></a>3.amcl使用</h4><h5 id="3-1编写amcl节点相关的launch文件"><a href="#3-1编写amcl节点相关的launch文件" class="headerlink" title="3.1编写amcl节点相关的launch文件"></a>3.1编写amcl节点相关的launch文件</h5><p>关于launch文件的实现，在amcl功能包下的example目录已经给出了示例，可以作为参考，具体实现:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">roscd amcl</span><br><span class="line">ls examples</span><br></pre></td></tr></table></figure>

<p>该目录下会列出两个文件: amcl_diff.launch 和 amcl_omni.launch  文件，前者适用于差分移动机器人，后者适用于全向移动机器人，可以按需选择，此处参考前者，新建 launch 文件，复制  amcl_diff.launch 文件内容并修改如下:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">launch</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">&quot;amcl&quot;</span> <span class="attr">type</span>=<span class="string">&quot;amcl&quot;</span> <span class="attr">name</span>=<span class="string">&quot;amcl&quot;</span> <span class="attr">output</span>=<span class="string">&quot;screen&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- Publish scans from best pose at a max of 10 Hz --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;odom_model_type&quot;</span> <span class="attr">value</span>=<span class="string">&quot;diff&quot;</span>/&gt;</span><span class="comment">&lt;!-- 里程计模式为差分 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;odom_alpha5&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0.1&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;transform_tolerance&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0.2&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;gui_publish_rate&quot;</span> <span class="attr">value</span>=<span class="string">&quot;10.0&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;laser_max_beams&quot;</span> <span class="attr">value</span>=<span class="string">&quot;30&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;min_particles&quot;</span> <span class="attr">value</span>=<span class="string">&quot;500&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;max_particles&quot;</span> <span class="attr">value</span>=<span class="string">&quot;5000&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;kld_err&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0.05&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;kld_z&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0.99&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;odom_alpha1&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0.2&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;odom_alpha2&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0.2&quot;</span>/&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- translation std dev, m --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;odom_alpha3&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0.8&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;odom_alpha4&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0.2&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;laser_z_hit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0.5&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;laser_z_short&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0.05&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;laser_z_max&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0.05&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;laser_z_rand&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0.5&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;laser_sigma_hit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0.2&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;laser_lambda_short&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0.1&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;laser_lambda_short&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0.1&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;laser_model_type&quot;</span> <span class="attr">value</span>=<span class="string">&quot;likelihood_field&quot;</span>/&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- &lt;param name=&quot;laser_model_type&quot; value=&quot;beam&quot;/&gt; --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;laser_likelihood_max_dist&quot;</span> <span class="attr">value</span>=<span class="string">&quot;2.0&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;update_min_d&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0.2&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;update_min_a&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0.5&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;odom_frame_id&quot;</span> <span class="attr">value</span>=<span class="string">&quot;odom&quot;</span>/&gt;</span><span class="comment">&lt;!-- 里程计坐标系 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;base_frame_id&quot;</span> <span class="attr">value</span>=<span class="string">&quot;base_footprint&quot;</span>/&gt;</span><span class="comment">&lt;!-- 添加机器人基坐标系 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;global_frame_id&quot;</span> <span class="attr">value</span>=<span class="string">&quot;map&quot;</span>/&gt;</span><span class="comment">&lt;!-- 添加地图坐标系 --&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;resample_interval&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;transform_tolerance&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0.1&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;recovery_alpha_slow&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0.0&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;recovery_alpha_fast&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0.0&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">node</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">launch</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="3-2编写测试launch文件"><a href="#3-2编写测试launch文件" class="headerlink" title="3.2编写测试launch文件"></a>3.2编写测试launch文件</h5><p>amcl节点是不可以单独运行的，运行 amcl 节点之前，需要先加载全局地图，然后启动 rviz 显示定位结果，上述节点可以集成进launch文件，内容示例如下:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">launch</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 设置地图的配置文件 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">arg</span> <span class="attr">name</span>=<span class="string">&quot;map&quot;</span> <span class="attr">default</span>=<span class="string">&quot;nav.yaml&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 运行地图服务器，并且加载设置的地图--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">name</span>=<span class="string">&quot;map_server&quot;</span> <span class="attr">pkg</span>=<span class="string">&quot;map_server&quot;</span> <span class="attr">type</span>=<span class="string">&quot;map_server&quot;</span> <span class="attr">args</span>=<span class="string">&quot;$(find mycar_nav)/map/$(arg map)&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 启动AMCL节点 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">include</span> <span class="attr">file</span>=<span class="string">&quot;$(find mycar_nav)/launch/amcl.launch&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 运行rviz --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">&quot;rviz&quot;</span> <span class="attr">type</span>=<span class="string">&quot;rviz&quot;</span> <span class="attr">name</span>=<span class="string">&quot;rviz&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">launch</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>当然，launch文件中地图服务节点和amcl节点中的包名、文件名需要根据自己的设置修改。</p>
<h5 id="3-3执行"><a href="#3-3执行" class="headerlink" title="3.3执行"></a>3.3执行</h5><p>1.先启动 Gazebo 仿真环境(此过程略)；</p>
<p>2.启动键盘控制节点：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rosrun teleop_twist_keyboard teleop_twist_keyboard.py</span><br></pre></td></tr></table></figure>

<p>3.启动上一步中集成地图服务、amcl 与 rviz 的 launch 文件；</p>
<p>4.在启动的 rviz 中，添加RobotModel、Map组件，分别显示机器人模型与地图，添加 posearray  插件，设置topic为particlecloud来显示 amcl 预估的当前机器人的位姿，箭头越是密集，说明当前机器人处于此位置的概率越高；</p>
<p>5.通过键盘控制机器人运动，会发现 posearray 也随之而改变。</p>
<hr>
<p><strong>另请参考:</strong></p>
<ul>
<li><a target="_blank" rel="noopener" href="http://wiki.ros.org/amcl">http://wiki.ros.org/amcl</a></li>
</ul>
<h3 id="7-2-4-导航实现04-路径规划"><a href="#7-2-4-导航实现04-路径规划" class="headerlink" title="7.2.4 导航实现04_路径规划"></a>7.2.4 导航实现04_路径规划</h3><p>毋庸置疑的，路径规划是导航中的核心功能之一，在ROS的导航功能包集navigation中提供了 move_base 功能包，用于实现此功能。</p>
<h4 id="1-move-base简介"><a href="#1-move-base简介" class="headerlink" title="1.move_base简介"></a>1.move_base简介</h4><p>move_base 功能包提供了基于动作(action)的路径规划实现，move_base  可以根据给定的目标点，控制机器人底盘运动至目标位置，并且在运动过程中会连续反馈机器人自身的姿态与目标点的状态信息。如前所述(7.1)move_base主要由全局路径规划与本地路径规划组成。</p>
<p>move_base已经被集成到了navigation包，navigation安装前面也有介绍，命令如下:</p>
<blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install ros-&lt;ROS版本&gt;-navigation</span><br></pre></td></tr></table></figure>
</blockquote>
<h4 id="2-move-base节点说明"><a href="#2-move-base节点说明" class="headerlink" title="2.move_base节点说明"></a>2.move_base节点说明</h4><p>move_base功能包中的核心节点是:move_base。为了方便调用，需要先了解该节点action、订阅的话题、发布的话题、服务以及相关参数。</p>
<h5 id="2-1动作"><a href="#2-1动作" class="headerlink" title="2.1动作"></a>2.1动作</h5><p><strong>动作订阅</strong></p>
<p>move_base&#x2F;goal(move_base_msgs&#x2F;MoveBaseActionGoal)</p>
<ul>
<li>move_base 的运动规划目标。</li>
</ul>
<p>move_base&#x2F;cancel(actionlib_msgs&#x2F;GoalID)</p>
<ul>
<li>取消目标。</li>
</ul>
<p><strong>动作发布</strong></p>
<p>move_base&#x2F;feedback(move_base_msgs&#x2F;MoveBaseActionFeedback)</p>
<ul>
<li>连续反馈的信息，包含机器人底盘坐标。</li>
</ul>
<p>move_base&#x2F;status(actionlib_msgs&#x2F;GoalStatusArray)</p>
<ul>
<li>发送到move_base的目标状态信息。</li>
</ul>
<p>move_base&#x2F;result(move_base_msgs&#x2F;MoveBaseActionResult)</p>
<ul>
<li>操作结果(此处为空)。</li>
</ul>
<h5 id="2-2订阅的Topic"><a href="#2-2订阅的Topic" class="headerlink" title="2.2订阅的Topic"></a>2.2订阅的Topic</h5><p>move_base_simple&#x2F;goal(geometry_msgs&#x2F;PoseStamped)</p>
<ul>
<li>运动规划目标(与action相比，没有连续反馈，无法追踪机器人执行状态)。</li>
</ul>
<h5 id="2-3发布的Topic"><a href="#2-3发布的Topic" class="headerlink" title="2.3发布的Topic"></a>2.3发布的Topic</h5><p>cmd_vel(geometry_msgs&#x2F;Twist)</p>
<ul>
<li>输出到机器人底盘的运动控制消息。</li>
</ul>
<h5 id="2-4服务"><a href="#2-4服务" class="headerlink" title="2.4服务"></a>2.4服务</h5><p>~make_plan(nav_msgs&#x2F;GetPlan)</p>
<ul>
<li>请求该服务，可以获取给定目标的规划路径，但是并不执行该路径规划。</li>
</ul>
<p>~clear_unknown_space(std_srvs&#x2F;Empty)</p>
<ul>
<li>允许用户直接清除机器人周围的未知空间。</li>
</ul>
<p>~clear_costmaps(std_srvs&#x2F;Empty)</p>
<ul>
<li>允许清除代价地图中的障碍物，可能会导致机器人与障碍物碰撞，请慎用。</li>
</ul>
<h5 id="2-5参数"><a href="#2-5参数" class="headerlink" title="2.5参数"></a>2.5参数</h5><p>请参考官网。</p>
<h4 id="3-move-base与代价地图"><a href="#3-move-base与代价地图" class="headerlink" title="3.move_base与代价地图"></a>3.move_base与代价地图</h4><h5 id="3-1概念"><a href="#3-1概念" class="headerlink" title="3.1概念"></a>3.1概念</h5><p>机器人导航(尤其是路径规划模块)是依赖于地图的，地图在SLAM时已经有所介绍了，ROS中的地图其实就是一张图片，这张图片有宽度、高度、分辨率等元数据，在图片中使用灰度值来表示障碍物存在的概率。不过SLAM构建的地图在导航中是不可以直接使用的，因为：</p>
<ol>
<li>SLAM构建的地图是静态地图，而导航过程中，障碍物信息是可变的，可能障碍物被移走了，也可能添加了新的障碍物，导航中需要时时的获取障碍物信息；</li>
<li>在靠近障碍物边缘时，虽然此处是空闲区域，但是机器人在进入该区域后可能由于其他一些因素，比如：惯性、或者不规则形体的机器人转弯时可能会与障碍物产生碰撞，安全起见，最好在地图的障碍物边缘设置警戒区，尽量禁止机器人进入…</li>
</ol>
<p>所以，静态地图无法直接应用于导航，其基础之上需要添加一些辅助信息的地图，比如时时获取的障碍物数据，基于静态地图添加的膨胀区等数据。</p>
<h5 id="3-2组成"><a href="#3-2组成" class="headerlink" title="3.2组成"></a>3.2组成</h5><p>代价地图有两张:global_costmap(全局代价地图) 和 local_costmap(本地代价地图)，前者用于全局路径规划，后者用于本地路径规划。</p>
<p>两张代价地图都可以多层叠加,一般有以下层级:</p>
<ul>
<li>Static Map Layer：静态地图层，SLAM构建的静态地图。</li>
<li>Obstacle Map Layer：障碍地图层，传感器感知的障碍物信息。</li>
<li>Inflation Layer：膨胀层，在以上两层地图上进行膨胀（向外扩张），以避免机器人的外壳会撞上障碍物。</li>
<li>Other Layers：自定义costmap。</li>
</ul>
<p>多个layer可以按需自由搭配。</p>


<h5 id="3-3碰撞算法"><a href="#3-3碰撞算法" class="headerlink" title="3.3碰撞算法"></a>3.3碰撞算法</h5><p>在ROS中，如何计算代价值呢？请看下图:</p>


<p>上图中，横轴是距离机器人中心的距离，纵轴是代价地图中栅格的灰度值。</p>
<ul>
<li>致命障碍:栅格值为254，此时障碍物与机器人中心重叠，必然发生碰撞；</li>
<li>内切障碍:栅格值为253，此时障碍物处于机器人的内切圆内，必然发生碰撞；</li>
<li>外切障碍:栅格值为[128,252]，此时障碍物处于其机器人的外切圆内，处于碰撞临界，不一定发生碰撞；</li>
<li>非自由空间:栅格值为(0,127]，此时机器人处于障碍物附近，属于危险警戒区，进入此区域，将来可能会发生碰撞；</li>
<li>自由区域:栅格值为0，此处机器人可以自由通过；</li>
<li>未知区域:栅格值为255，还没探明是否有障碍物。</li>
</ul>
<p>膨胀空间的设置可以参考非自由空间。</p>
<h4 id="4-move-base使用"><a href="#4-move-base使用" class="headerlink" title="4.move_base使用"></a>4.move_base使用</h4><p>路径规划算法在move_base功能包的move_base节点中已经封装完毕了，但是还不可以直接调用，因为算法虽然已经封装了，但是该功能包面向的是各种类型支持ROS的机器人，不同类型机器人可能大小尺寸不同，传感器不同，速度不同，应用场景不同….最后可能会导致不同的路径规划结果，那么在调用路径规划节点之前，我们还需要配置机器人参数。具体实现如下:</p>
<ol>
<li>先编写launch文件模板</li>
<li>编写配置文件</li>
<li>集成导航相关的launch文件</li>
<li>测试</li>
</ol>
<h5 id="4-1launch文件"><a href="#4-1launch文件" class="headerlink" title="4.1launch文件"></a>4.1launch文件</h5><p>关于move_base节点的调用，模板如下:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">launch</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">&quot;move_base&quot;</span> <span class="attr">type</span>=<span class="string">&quot;move_base&quot;</span> <span class="attr">respawn</span>=<span class="string">&quot;false&quot;</span> <span class="attr">name</span>=<span class="string">&quot;move_base&quot;</span> <span class="attr">output</span>=<span class="string">&quot;screen&quot;</span> <span class="attr">clear_params</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rosparam</span> <span class="attr">file</span>=<span class="string">&quot;$(find 功能包)/param/costmap_common_params.yaml&quot;</span> <span class="attr">command</span>=<span class="string">&quot;load&quot;</span> <span class="attr">ns</span>=<span class="string">&quot;global_costmap&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rosparam</span> <span class="attr">file</span>=<span class="string">&quot;$(find 功能包)/param/costmap_common_params.yaml&quot;</span> <span class="attr">command</span>=<span class="string">&quot;load&quot;</span> <span class="attr">ns</span>=<span class="string">&quot;local_costmap&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rosparam</span> <span class="attr">file</span>=<span class="string">&quot;$(find 功能包)/param/local_costmap_params.yaml&quot;</span> <span class="attr">command</span>=<span class="string">&quot;load&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rosparam</span> <span class="attr">file</span>=<span class="string">&quot;$(find 功能包)/param/global_costmap_params.yaml&quot;</span> <span class="attr">command</span>=<span class="string">&quot;load&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rosparam</span> <span class="attr">file</span>=<span class="string">&quot;$(find 功能包)/param/base_local_planner_params.yaml&quot;</span> <span class="attr">command</span>=<span class="string">&quot;load&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">node</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">launch</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>launch文件解释:</p>
<p>启动了 move_base 功能包下的 move_base 节点，respawn 为  false，意味着该节点关闭后，不会被重启；clear_params 为 true，意味着每次启动该节点都要清空私有参数然后重新载入；通过  rosparam 会载入若干 yaml 文件用于配置参数，这些yaml文件的配置以及作用详见下一小节内容。</p>
<h5 id="4-2配置文件"><a href="#4-2配置文件" class="headerlink" title="4.2配置文件"></a>4.2配置文件</h5><p>关于配置文件的编写，可以参考一些成熟的机器人的路径规划实现，比如: turtlebot3，github链接：<a target="_blank" rel="noopener" href="https://github.com/ROBOTIS-GIT/turtlebot3/tree/master/turtlebot3_navigation/param%EF%BC%8C%E5%85%88%E4%B8%8B%E8%BD%BD%E8%BF%99%E4%BA%9B%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%A4%87%E7%94%A8%E3%80%82">https://github.com/ROBOTIS-GIT/turtlebot3/tree/master/turtlebot3_navigation/param，先下载这些配置文件备用。</a></p>
<p>在功能包下新建 param 目录，复制下载的文件到此目录:  costmap_common_params_burger.yaml、local_costmap_params.yaml、global_costmap_params.yaml、base_local_planner_params.yaml，并将costmap_common_params_burger.yaml 重命名为:costmap_common_params.yaml。</p>
<p>配置文件修改以及解释:</p>
<h6 id="4-2-1costmap-common-params-yaml"><a href="#4-2-1costmap-common-params-yaml" class="headerlink" title="4.2.1costmap_common_params.yaml"></a>4.2.1costmap_common_params.yaml</h6><p>该文件是move_base 在全局路径规划与本地路径规划时调用的通用参数，包括:机器人的尺寸、距离障碍物的安全距离、传感器信息等。配置参考如下:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#机器人几何参，如果机器人是圆形，设置 robot_radius,如果是其他形状设置 footprint</span></span><br><span class="line"><span class="attr">robot_radius:</span> <span class="number">0.12</span> <span class="comment">#圆形</span></span><br><span class="line"><span class="comment"># footprint: [[-0.12, -0.12], [-0.12, 0.12], [0.12, 0.12], [0.12, -0.12]] #其他形状</span></span><br><span class="line"></span><br><span class="line"><span class="attr">obstacle_range:</span> <span class="number">3.0</span> <span class="comment"># 用于障碍物探测，比如: 值为 3.0，意味着检测到距离小于 3 米的障碍物时，就会引入代价地图</span></span><br><span class="line"><span class="attr">raytrace_range:</span> <span class="number">3.5</span> <span class="comment"># 用于清除障碍物，比如：值为 3.5，意味着清除代价地图中 3.5 米以外的障碍物</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#膨胀半径，扩展在碰撞区域以外的代价区域，使得机器人规划路径避开障碍物</span></span><br><span class="line"><span class="attr">inflation_radius:</span> <span class="number">0.2</span></span><br><span class="line"><span class="comment">#代价比例系数，越大则代价值越小</span></span><br><span class="line"><span class="attr">cost_scaling_factor:</span> <span class="number">3.0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#地图类型</span></span><br><span class="line"><span class="attr">map_type:</span> <span class="string">costmap</span></span><br><span class="line"><span class="comment">#导航包所需要的传感器</span></span><br><span class="line"><span class="attr">observation_sources:</span> <span class="string">scan</span></span><br><span class="line"><span class="comment">#对传感器的坐标系和数据进行配置。这个也会用于代价地图添加和清除障碍物。例如，你可以用激光雷达传感器用于在代价地图添加障碍物，再添加kinect用于导航和清除障碍物。</span></span><br><span class="line"><span class="attr">scan:</span> &#123;<span class="attr">sensor_frame:</span> <span class="string">laser</span>, <span class="attr">data_type:</span> <span class="string">LaserScan</span>, <span class="attr">topic:</span> <span class="string">scan</span>, <span class="attr">marking:</span> <span class="literal">true</span>, <span class="attr">clearing:</span> <span class="literal">true</span>&#125;</span><br></pre></td></tr></table></figure>

<h6 id="-1"><a href="#-1" class="headerlink" title=""></a></h6><h6 id="4-2-2global-costmap-params-yaml"><a href="#4-2-2global-costmap-params-yaml" class="headerlink" title="4.2.2global_costmap_params.yaml"></a>4.2.2global_costmap_params.yaml</h6><p>该文件用于全局代价地图参数设置:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">global_costmap:</span></span><br><span class="line">  <span class="attr">global_frame:</span> <span class="string">map</span> <span class="comment">#地图坐标系</span></span><br><span class="line">  <span class="attr">robot_base_frame:</span> <span class="string">base_footprint</span> <span class="comment">#机器人坐标系</span></span><br><span class="line">  <span class="comment"># 以此实现坐标变换</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">update_frequency:</span> <span class="number">1.0</span> <span class="comment">#代价地图更新频率</span></span><br><span class="line">  <span class="attr">publish_frequency:</span> <span class="number">1.0</span> <span class="comment">#代价地图的发布频率</span></span><br><span class="line">  <span class="attr">transform_tolerance:</span> <span class="number">0.5</span> <span class="comment">#等待坐标变换发布信息的超时时间</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">static_map:</span> <span class="literal">true</span> <span class="comment"># 是否使用一个地图或者地图服务器来初始化全局代价地图，如果不使用静态地图，这个参数为false.</span></span><br></pre></td></tr></table></figure>

<h6 id="4-2-3local-costmap-params-yaml"><a href="#4-2-3local-costmap-params-yaml" class="headerlink" title="4.2.3local_costmap_params.yaml"></a>4.2.3local_costmap_params.yaml</h6><p>该文件用于局部代价地图参数设置:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">local_costmap:</span></span><br><span class="line">  <span class="attr">global_frame:</span> <span class="string">odom</span> <span class="comment">#里程计坐标系</span></span><br><span class="line">  <span class="attr">robot_base_frame:</span> <span class="string">base_footprint</span> <span class="comment">#机器人坐标系</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">update_frequency:</span> <span class="number">10.0</span> <span class="comment">#代价地图更新频率</span></span><br><span class="line">  <span class="attr">publish_frequency:</span> <span class="number">10.0</span> <span class="comment">#代价地图的发布频率</span></span><br><span class="line">  <span class="attr">transform_tolerance:</span> <span class="number">0.5</span> <span class="comment">#等待坐标变换发布信息的超时时间</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">static_map:</span> <span class="literal">false</span>  <span class="comment">#不需要静态地图，可以提升导航效果</span></span><br><span class="line">  <span class="attr">rolling_window:</span> <span class="literal">true</span> <span class="comment">#是否使用动态窗口，默认为false，在静态的全局地图中，地图不会变化</span></span><br><span class="line">  <span class="attr">width:</span> <span class="number">3</span> <span class="comment"># 局部地图宽度 单位是 m</span></span><br><span class="line">  <span class="attr">height:</span> <span class="number">3</span> <span class="comment"># 局部地图高度 单位是 m</span></span><br><span class="line">  <span class="attr">resolution:</span> <span class="number">0.05</span> <span class="comment"># 局部地图分辨率 单位是 m，一般与静态地图分辨率保持一致</span></span><br></pre></td></tr></table></figure>

<h6 id="4-2-4base-local-planner-params"><a href="#4-2-4base-local-planner-params" class="headerlink" title="4.2.4base_local_planner_params"></a>4.2.4base_local_planner_params</h6><p>基本的局部规划器参数配置，这个配置文件设定了机器人的最大和最小速度限制值，也设定了加速度的阈值。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">TrajectoryPlannerROS:</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Robot Configuration Parameters</span></span><br><span class="line">  <span class="attr">max_vel_x:</span> <span class="number">0.5</span> <span class="comment"># X 方向最大速度</span></span><br><span class="line">  <span class="attr">min_vel_x:</span> <span class="number">0.1</span> <span class="comment"># X 方向最小速速</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">max_vel_theta:</span>  <span class="number">1.0</span> <span class="comment"># </span></span><br><span class="line">  <span class="attr">min_vel_theta:</span> <span class="number">-1.0</span></span><br><span class="line">  <span class="attr">min_in_place_vel_theta:</span> <span class="number">1.0</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">acc_lim_x:</span> <span class="number">1.0</span> <span class="comment"># X 加速限制</span></span><br><span class="line">  <span class="attr">acc_lim_y:</span> <span class="number">0.0</span> <span class="comment"># Y 加速限制</span></span><br><span class="line">  <span class="attr">acc_lim_theta:</span> <span class="number">0.6</span> <span class="comment"># 角速度加速限制</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Goal Tolerance Parameters，目标公差</span></span><br><span class="line">  <span class="attr">xy_goal_tolerance:</span> <span class="number">0.10</span></span><br><span class="line">  <span class="attr">yaw_goal_tolerance:</span> <span class="number">0.05</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Differential-drive robot configuration</span></span><br><span class="line"><span class="comment"># 是否是全向移动机器人</span></span><br><span class="line">  <span class="attr">holonomic_robot:</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Forward Simulation Parameters，前进模拟参数</span></span><br><span class="line">  <span class="attr">sim_time:</span> <span class="number">0.8</span></span><br><span class="line">  <span class="attr">vx_samples:</span> <span class="number">18</span></span><br><span class="line">  <span class="attr">vtheta_samples:</span> <span class="number">20</span></span><br><span class="line">  <span class="attr">sim_granularity:</span> <span class="number">0.05</span></span><br></pre></td></tr></table></figure>

<h6 id="4-2-5参数配置技巧"><a href="#4-2-5参数配置技巧" class="headerlink" title="4.2.5参数配置技巧"></a>4.2.5参数配置技巧</h6><p>以上配置在实操中，可能会出现机器人在本地路径规划时与全局路径规划不符而进入膨胀区域出现假死的情况，如何尽量避免这种情形呢？</p>
<blockquote>
<p>全局路径规划与本地路径规划虽然设置的参数是一样的，但是二者路径规划和避障的职能不同，可以采用不同的参数设置策略:</p>
<ul>
<li>全局代价地图可以将膨胀半径和障碍物系数设置的偏大一些；</li>
<li>本地代价地图可以将膨胀半径和障碍物系数设置的偏小一些。</li>
</ul>
<p>这样，在全局路径规划时，规划的路径会尽量远离障碍物，而本地路径规划时，机器人即便偏离全局路径也会和障碍物之间保留更大的自由空间，从而避免了陷入“假死”的情形。</p>
</blockquote>
<h5 id="4-3launch文件集成"><a href="#4-3launch文件集成" class="headerlink" title="4.3launch文件集成"></a>4.3launch文件集成</h5><p>如果要实现导航，需要集成地图服务、amcl 、move_base 与 Rviz 等，集成示例如下:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">launch</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 设置地图的配置文件 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">arg</span> <span class="attr">name</span>=<span class="string">&quot;map&quot;</span> <span class="attr">default</span>=<span class="string">&quot;nav.yaml&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 运行地图服务器，并且加载设置的地图--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">name</span>=<span class="string">&quot;map_server&quot;</span> <span class="attr">pkg</span>=<span class="string">&quot;map_server&quot;</span> <span class="attr">type</span>=<span class="string">&quot;map_server&quot;</span> <span class="attr">args</span>=<span class="string">&quot;$(find mycar_nav)/map/$(arg map)&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 启动AMCL节点 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">include</span> <span class="attr">file</span>=<span class="string">&quot;$(find mycar_nav)/launch/amcl.launch&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 运行move_base节点 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">include</span> <span class="attr">file</span>=<span class="string">&quot;$(find mycar_nav)/launch/path.launch&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 运行rviz --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">&quot;rviz&quot;</span> <span class="attr">type</span>=<span class="string">&quot;rviz&quot;</span> <span class="attr">name</span>=<span class="string">&quot;rviz&quot;</span> <span class="attr">args</span>=<span class="string">&quot;-d $(find mycar_nav)/rviz/nav.rviz&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">launch</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="4-4测试"><a href="#4-4测试" class="headerlink" title="4.4测试"></a>4.4测试</h5><p>1.先启动 Gazebo 仿真环境(此过程略)；</p>
<p>2.启动导航相关的 launch 文件；</p>
<p>3.添加Rviz组件(参考演示结果),可以将配置数据保存，后期直接调用；</p>
<p>全局代价地图与本地代价地图组件配置如下:</p>


<p>全局路径规划与本地路径规划组件配置如下:</p>


<p>4.通过Rviz工具栏的 2D Nav Goal设置目的地实现导航。</p>
5.也可以在导航过程中，添加新的障碍物，机器人也可以自动躲避障碍物。

<hr>
<p><strong>另请参考:</strong></p>
<ul>
<li><a target="_blank" rel="noopener" href="http://wiki.ros.org/move_base">http://wiki.ros.org/move_base</a></li>
</ul>
<h3 id="7-2-5-导航与SLAM建图"><a href="#7-2-5-导航与SLAM建图" class="headerlink" title="7.2.5 导航与SLAM建图"></a>7.2.5 导航与SLAM建图</h3><blockquote>
<p>场景:在 7.2.1 导航实现01_SLAM建图中，我们是通过键盘控制机器人移动实现建图的，而后续又介绍了机器人的自主移动实现，那么可不可以将二者结合，实现机器人自主移动的SLAM建图呢？</p>
</blockquote>
<p>上述需求是可行的。虽然可能会有疑问，导航时需要地图信息，之前导航实现时，是通过 map_server 包的 map_server  节点来发布地图信息的，如果不先通过SLAM建图，那么如何发布地图信息呢？SLAM建图过程中本身就会时时发布地图信息，所以无需再使用map_server，SLAM已经发布了话题为 &#x2F;map 的地图消息了，且导航需要定位模块，SLAM本身也是可以实现定位的。</p>
<p>该过程实现比较简单，步骤如下:</p>
<ol>
<li>编写launch文件，集成SLAM与move_base相关节点；</li>
<li>执行launch文件并测试。</li>
</ol>
<h4 id="1-编写launc文件"><a href="#1-编写launc文件" class="headerlink" title="1.编写launc文件"></a>1.编写launc文件</h4><p>当前launch文件实现，无需调用map_server的相关节点，只需要启动SLAM节点与move_base节点，示例内容如下:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">launch</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 启动SLAM节点 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">include</span> <span class="attr">file</span>=<span class="string">&quot;$(find mycar_nav)/launch/slam.launch&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 运行move_base节点 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">include</span> <span class="attr">file</span>=<span class="string">&quot;$(find mycar_nav)/launch/path.launch&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 运行rviz --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">&quot;rviz&quot;</span> <span class="attr">type</span>=<span class="string">&quot;rviz&quot;</span> <span class="attr">name</span>=<span class="string">&quot;rviz&quot;</span> <span class="attr">args</span>=<span class="string">&quot;-d $(find mycar_nav)/rviz/nav.rviz&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">launch</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="2-测试"><a href="#2-测试" class="headerlink" title="2.测试"></a>2.测试</h4><p>1.首先运行gazebo仿真环境；</p>
<p>2.然后执行launch文件；</p>
<p>3.在rviz中通过2D Nav Goal设置目标点，机器人开始自主移动并建图了；</p>
<p>4.最后可以使用 map_server 保存地图。</p>


<h2 id="7-3-导航相关消息"><a href="#7-3-导航相关消息" class="headerlink" title="7.3 导航相关消息"></a>7.3 导航相关消息</h2><p>在导航功能包集中包含了诸多节点，毋庸置疑的，不同节点之间的通信使用到了消息中间件(数据载体)，在上一节的实现中，这些消息已经在rviz中做了可视化处理，比如:地图、雷达、摄像头、里程计、路径规划…的相关消息在rviz中提供了相关组件，本节主要介绍这些消息的具体格式。</p>
<h3 id="7-3-1-导航之地图"><a href="#7-3-1-导航之地图" class="headerlink" title="7.3.1 导航之地图"></a>7.3.1 导航之地图</h3><p>地图相关的消息主要有两个:</p>
<p>nav_msgs&#x2F;MapMetaData</p>
<ul>
<li>地图元数据，包括地图的宽度、高度、分辨率等。</li>
</ul>
<p>nav_msgs&#x2F;OccupancyGrid</p>
<ul>
<li>地图栅格数据，一般会在rviz中以图形化的方式显示。</li>
</ul>
<h4 id="1-nav-msgs-MapMetaData"><a href="#1-nav-msgs-MapMetaData" class="headerlink" title="1.nav_msgs&#x2F;MapMetaData"></a>1.nav_msgs&#x2F;MapMetaData</h4><p>调用<code>rosmsg info nav_msgs/MapMetaData</code>显示消息内容如下:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">time map_load_time</span><br><span class="line">float32 resolution #地图分辨率</span><br><span class="line">uint32 width #地图宽度</span><br><span class="line">uint32 height #地图高度</span><br><span class="line">geometry_msgs/Pose origin #地图位姿数据</span><br><span class="line">  geometry_msgs/Point position</span><br><span class="line">    float64 x</span><br><span class="line">    float64 y</span><br><span class="line">    float64 z</span><br><span class="line">  geometry_msgs/Quaternion orientation</span><br><span class="line">    float64 x</span><br><span class="line">    float64 y</span><br><span class="line">    float64 z</span><br><span class="line">    float64 w</span><br></pre></td></tr></table></figure>

<h4 id="2-nav-msgs-OccupancyGrid"><a href="#2-nav-msgs-OccupancyGrid" class="headerlink" title="2.nav_msgs&#x2F;OccupancyGrid"></a>2.nav_msgs&#x2F;OccupancyGrid</h4><p>调用 <code>rosmsg info nav_msgs/OccupancyGrid</code>显示消息内容如下:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">std_msgs/Header header</span><br><span class="line">  uint32 seq</span><br><span class="line">  time stamp</span><br><span class="line">  string frame_id</span><br><span class="line">#--- 地图元数据</span><br><span class="line">nav_msgs/MapMetaData info</span><br><span class="line">  time map_load_time</span><br><span class="line">  float32 resolution</span><br><span class="line">  uint32 width</span><br><span class="line">  uint32 height</span><br><span class="line">  geometry_msgs/Pose origin</span><br><span class="line">    geometry_msgs/Point position</span><br><span class="line">      float64 x</span><br><span class="line">      float64 y</span><br><span class="line">      float64 z</span><br><span class="line">    geometry_msgs/Quaternion orientation</span><br><span class="line">      float64 x</span><br><span class="line">      float64 y</span><br><span class="line">      float64 z</span><br><span class="line">      float64 w</span><br><span class="line">#--- 地图内容数据，数组长度 = width * height</span><br><span class="line">int8[] data</span><br></pre></td></tr></table></figure>

<h3 id="7-3-2-导航之里程计"><a href="#7-3-2-导航之里程计" class="headerlink" title="7.3.2 导航之里程计"></a>7.3.2 导航之里程计</h3><p>里程计相关消息是:nav_msgs&#x2F;Odometry，调用<code>rosmsg info nav_msgs/Odometry</code> 显示消息内容如下:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">std_msgs/Header header</span><br><span class="line">  uint32 seq</span><br><span class="line">  time stamp</span><br><span class="line">  string frame_id</span><br><span class="line">string child_frame_id</span><br><span class="line">geometry_msgs/PoseWithCovariance pose</span><br><span class="line">  geometry_msgs/Pose pose #里程计位姿</span><br><span class="line">    geometry_msgs/Point position</span><br><span class="line">      float64 x</span><br><span class="line">      float64 y</span><br><span class="line">      float64 z</span><br><span class="line">    geometry_msgs/Quaternion orientation</span><br><span class="line">      float64 x</span><br><span class="line">      float64 y</span><br><span class="line">      float64 z</span><br><span class="line">      float64 w</span><br><span class="line">  float64[36] covariance</span><br><span class="line">geometry_msgs/TwistWithCovariance twist</span><br><span class="line">  geometry_msgs/Twist twist #速度</span><br><span class="line">    geometry_msgs/Vector3 linear</span><br><span class="line">      float64 x</span><br><span class="line">      float64 y</span><br><span class="line">      float64 z</span><br><span class="line">    geometry_msgs/Vector3 angular</span><br><span class="line">      float64 x</span><br><span class="line">      float64 y</span><br><span class="line">      float64 z    </span><br><span class="line">  # 协方差矩阵</span><br><span class="line">  float64[36] covariance</span><br></pre></td></tr></table></figure>

<h3 id="7-3-3-导航之坐标变换"><a href="#7-3-3-导航之坐标变换" class="headerlink" title="7.3.3 导航之坐标变换"></a>7.3.3 导航之坐标变换</h3><p>坐标变换相关消息是: tf&#x2F;tfMessage，调用<code>rosmsg info tf/tfMessage</code> 显示消息内容如下:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">geometry_msgs/TransformStamped[] transforms #包含了多个坐标系相对关系数据的数组</span><br><span class="line">  std_msgs/Header header</span><br><span class="line">    uint32 seq</span><br><span class="line">    time stamp</span><br><span class="line">    string frame_id</span><br><span class="line">  string child_frame_id</span><br><span class="line">  geometry_msgs/Transform transform</span><br><span class="line">    geometry_msgs/Vector3 translation</span><br><span class="line">      float64 x</span><br><span class="line">      float64 y</span><br><span class="line">      float64 z</span><br><span class="line">    geometry_msgs/Quaternion rotation</span><br><span class="line">      float64 x</span><br><span class="line">      float64 y</span><br><span class="line">      float64 z</span><br><span class="line">      float64 w</span><br></pre></td></tr></table></figure>

<h3 id="7-3-4-导航之定位"><a href="#7-3-4-导航之定位" class="headerlink" title="7.3.4 导航之定位"></a>7.3.4 导航之定位</h3><p>定位相关消息是:geometry_msgs&#x2F;PoseArray，调用<code>rosmsg info geometry_msgs/PoseArray</code>显示消息内容如下:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">std_msgs/Header header</span><br><span class="line">  uint32 seq</span><br><span class="line">  time stamp</span><br><span class="line">  string frame_id</span><br><span class="line">geometry_msgs/Pose[] poses #预估的点位姿组成的数组</span><br><span class="line">  geometry_msgs/Point position</span><br><span class="line">    float64 x</span><br><span class="line">    float64 y</span><br><span class="line">    float64 z</span><br><span class="line">  geometry_msgs/Quaternion orientation</span><br><span class="line">    float64 x</span><br><span class="line">    float64 y</span><br><span class="line">    float64 z</span><br><span class="line">    float64 w</span><br></pre></td></tr></table></figure>

<h3 id="7-3-5-导航之目标点与路径规划"><a href="#7-3-5-导航之目标点与路径规划" class="headerlink" title="7.3.5 导航之目标点与路径规划"></a>7.3.5 导航之目标点与路径规划</h3><p>目标点相关消息是:move_base_msgs&#x2F;MoveBaseActionGoal，调用<code>rosmsg info move_base_msgs/MoveBaseActionGoal</code>显示消息内容如下:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">std_msgs/Header header</span><br><span class="line">  uint32 seq</span><br><span class="line">  time stamp</span><br><span class="line">  string frame_id</span><br><span class="line">actionlib_msgs/GoalID goal_id</span><br><span class="line">  time stamp</span><br><span class="line">  string id</span><br><span class="line">move_base_msgs/MoveBaseGoal goal</span><br><span class="line">  geometry_msgs/PoseStamped target_pose</span><br><span class="line">    std_msgs/Header header</span><br><span class="line">      uint32 seq</span><br><span class="line">      time stamp</span><br><span class="line">      string frame_id</span><br><span class="line">    geometry_msgs/Pose pose #目标点位姿</span><br><span class="line">      geometry_msgs/Point position</span><br><span class="line">        float64 x</span><br><span class="line">        float64 y</span><br><span class="line">        float64 z</span><br><span class="line">      geometry_msgs/Quaternion orientation</span><br><span class="line">        float64 x</span><br><span class="line">        float64 y</span><br><span class="line">        float64 z</span><br><span class="line">        float64 w</span><br></pre></td></tr></table></figure>

<p>路径规划相关消息是:nav_msgs&#x2F;Path，调用<code>rosmsg info nav_msgs/Path</code>显示消息内容如下:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">std_msgs/Header header</span><br><span class="line">  uint32 seq</span><br><span class="line">  time stamp</span><br><span class="line">  string frame_id</span><br><span class="line">geometry_msgs/PoseStamped[] poses #由一系列点组成的数组</span><br><span class="line">  std_msgs/Header header</span><br><span class="line">    uint32 seq</span><br><span class="line">    time stamp</span><br><span class="line">    string frame_id</span><br><span class="line">  geometry_msgs/Pose pose</span><br><span class="line">    geometry_msgs/Point position</span><br><span class="line">      float64 x</span><br><span class="line">      float64 y</span><br><span class="line">      float64 z</span><br><span class="line">    geometry_msgs/Quaternion orientation</span><br><span class="line">      float64 x</span><br><span class="line">      float64 y</span><br><span class="line">      float64 z</span><br><span class="line">      float64 w</span><br></pre></td></tr></table></figure>

<h3 id="7-3-6-导航之激光雷达"><a href="#7-3-6-导航之激光雷达" class="headerlink" title="7.3.6 导航之激光雷达"></a>7.3.6 导航之激光雷达</h3><p>激光雷达相关消息是:sensor_msgs&#x2F;LaserScan，调用<code>rosmsg info sensor_msgs/LaserScan</code>显示消息内容如下:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">std_msgs/Header header</span><br><span class="line">  uint32 seq</span><br><span class="line">  time stamp</span><br><span class="line">  string frame_id</span><br><span class="line">float32 angle_min #起始扫描角度(rad)</span><br><span class="line">float32 angle_max #终止扫描角度(rad)</span><br><span class="line">float32 angle_increment #测量值之间的角距离(rad)</span><br><span class="line">float32 time_increment #测量间隔时间(s)</span><br><span class="line">float32 scan_time #扫描间隔时间(s)</span><br><span class="line">float32 range_min #最小有效距离值(m)</span><br><span class="line">float32 range_max #最大有效距离值(m)</span><br><span class="line">float32[] ranges #一个周期的扫描数据</span><br><span class="line">float32[] intensities #扫描强度数据，如果设备不支持强度数据，该数组为空</span><br></pre></td></tr></table></figure>

<h3 id="7-3-7-导航之相机"><a href="#7-3-7-导航之相机" class="headerlink" title="7.3.7 导航之相机"></a>7.3.7 导航之相机</h3><p>深度相机相关消息有:sensor_msgs&#x2F;Image、sensor_msgs&#x2F;CompressedImage、sensor_msgs&#x2F;PointCloud2</p>
<p>sensor_msgs&#x2F;Image 对应的一般的图像数据，sensor_msgs&#x2F;CompressedImage 对应压缩后的图像数据，sensor_msgs&#x2F;PointCloud2 对应的是点云数据(带有深度信息的图像数据)。</p>
<p>调用<code>rosmsg info sensor_msgs/Image</code>显示消息内容如下:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">std_msgs/Header header</span><br><span class="line">  uint32 seq</span><br><span class="line">  time stamp</span><br><span class="line">  string frame_id</span><br><span class="line">uint32 height #高度</span><br><span class="line">uint32 width  #宽度</span><br><span class="line">string encoding #编码格式:RGB、YUV等</span><br><span class="line">uint8 is_bigendian #图像大小端存储模式</span><br><span class="line">uint32 step #一行图像数据的字节数，作为步进参数</span><br><span class="line">uint8[] data #图像数据，长度等于 step * height</span><br></pre></td></tr></table></figure>

<p>调用<code>rosmsg info sensor_msgs/CompressedImage</code>显示消息内容如下:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">std_msgs/Header header</span><br><span class="line">  uint32 seq</span><br><span class="line">  time stamp</span><br><span class="line">  string frame_id</span><br><span class="line">string format #压缩编码格式(jpeg、png、bmp)</span><br><span class="line">uint8[] data #压缩后的数据</span><br></pre></td></tr></table></figure>

<p>调用<code>rosmsg info sensor_msgs/PointCloud2</code>显示消息内容如下:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">std_msgs/Header header</span><br><span class="line">  uint32 seq</span><br><span class="line">  time stamp</span><br><span class="line">  string frame_id</span><br><span class="line">uint32 height #高度</span><br><span class="line">uint32 width  #宽度</span><br><span class="line">sensor_msgs/PointField[] fields #每个点的数据类型</span><br><span class="line">  uint8 INT8=1</span><br><span class="line">  uint8 UINT8=2</span><br><span class="line">  uint8 INT16=3</span><br><span class="line">  uint8 UINT16=4</span><br><span class="line">  uint8 INT32=5</span><br><span class="line">  uint8 UINT32=6</span><br><span class="line">  uint8 FLOAT32=7</span><br><span class="line">  uint8 FLOAT64=8</span><br><span class="line">  string name</span><br><span class="line">  uint32 offset</span><br><span class="line">  uint8 datatype</span><br><span class="line">  uint32 count</span><br><span class="line">bool is_bigendian #图像大小端存储模式</span><br><span class="line">uint32 point_step #单点的数据字节步长</span><br><span class="line">uint32 row_step   #一行数据的字节步长</span><br><span class="line">uint8[] data      #存储点云的数组，总长度为 row_step * height</span><br><span class="line">bool is_dense     #是否有无效点</span><br></pre></td></tr></table></figure>

<h3 id="7-3-5-深度图像转激光数据"><a href="#7-3-5-深度图像转激光数据" class="headerlink" title="7.3.5 深度图像转激光数据"></a>7.3.5 深度图像转激光数据</h3><p>本节介绍ROS中的一个功能包:depthimage_to_laserscan，顾名思义，该功能包可以将深度图像信息转换成激光雷达信息，应用场景如下:</p>
<blockquote>
<p>在诸多SLAM算法中，一般都需要订阅激光雷达数据用于构建地图，因为激光雷达可以感知周围环境的深度信息，而深度相机也具备感知深度信息的功能，且最初激光雷达价格比价比较昂贵，那么在传感器选型上可以选用深度相机代替激光雷达吗？</p>
</blockquote>
<p>答案是可以的，不过二者发布的消息类型是完全不同的，如果想要实现传感器的置换，那么就需要将深度相机发布的三维的图形信息转换成二维的激光雷达信息，这一功能就是通过depthimage_to_laserscan来实现的。</p>
<h4 id="1-depthimage-to-laserscan简介"><a href="#1-depthimage-to-laserscan简介" class="headerlink" title="1.depthimage_to_laserscan简介"></a>1.depthimage_to_laserscan简介</h4><h5 id="1-1原理"><a href="#1-1原理" class="headerlink" title="1.1原理"></a>1.1原理</h5><p>depthimage_to_laserscan将实现深度图像与雷达数据转换的原理比较简单，雷达数据是二维的、平面的，深度图像是三维的，是若干二维(水平)数据的纵向叠加，如果将三维的数据转换成二维数据，只需要取深度图的某一层即可，为了方面理解，请看官方示例:</p>
<p>图一:深度相机与外部环境(实物图)</p>


<p>图二:深度相机发布的图片信息，图中彩线对应的是要转换成雷达信息的数据</p>


<p>图三:将图二以点云的方式显示更为直观，图中彩线对应的仍然是要转换成雷达信息的数据</p>


<p>图四:转换之后的结果图(俯视)</p>


<h5 id="1-2优缺点"><a href="#1-2优缺点" class="headerlink" title="1.2优缺点"></a>1.2优缺点</h5><p>**优点:**深度相机的成本一般低于激光雷达，可以降低硬件成本；</p>
<p><strong>缺点:</strong> 深度相机较之于激光雷达无论是检测范围还是精度都有不小的差距，SLAM效果可能不如激光雷达理想。</p>
<h5 id="1-3安装"><a href="#1-3安装" class="headerlink" title="1.3安装"></a>1.3安装</h5><p>使用之前请先安装,命令如下:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install ros-melodic-depthimage-to-laserscan</span><br></pre></td></tr></table></figure>

<h4 id="2-depthimage-to-laserscan节点说明"><a href="#2-depthimage-to-laserscan节点说明" class="headerlink" title="2.depthimage_to_laserscan节点说明"></a>2.depthimage_to_laserscan节点说明</h4><p>depthimage_to_laserscan 功能包的核心节点是:depthimage_to_laserscan ，为了方便调用，需要先了解该节点订阅的话题、发布的话题以及相关参数。</p>
<h5 id="2-1订阅的Topic-1"><a href="#2-1订阅的Topic-1" class="headerlink" title="2.1订阅的Topic"></a>2.1订阅的Topic</h5><p>image(sensor_msgs&#x2F;Image)</p>
<ul>
<li>输入图像信息。</li>
</ul>
<p>camera_info(sensor_msgs&#x2F;CameraInfo)</p>
<ul>
<li>关联图像的相机信息。通常不需要重新映射，因为camera_info将从与image相同的命名空间中进行订阅。</li>
</ul>
<h5 id="2-2发布的Topic-1"><a href="#2-2发布的Topic-1" class="headerlink" title="2.2发布的Topic"></a>2.2发布的Topic</h5><p>scan(sensor_msgs&#x2F;LaserScan)</p>
<ul>
<li>发布转换成的激光雷达类型数据。</li>
</ul>
<h5 id="2-3参数"><a href="#2-3参数" class="headerlink" title="2.3参数"></a>2.3参数</h5><p>该节点参数较少，只有如下几个，一般需要设置的是: output_frame_id。</p>
<p>~scan_height(int, default: 1 pixel)</p>
<ul>
<li>设置用于生成激光雷达信息的象素行数。</li>
</ul>
<p>~scan_time(double, default: 1&#x2F;30.0Hz (0.033s))</p>
<ul>
<li>两次扫描的时间间隔。</li>
</ul>
<p>~range_min(double, default: 0.45m)</p>
<ul>
<li>返回的最小范围。结合range_max使用，只会获取 range_min 与 range_max 之间的数据。</li>
</ul>
<p>~range_max(double, default: 10.0m)</p>
<ul>
<li>返回的最大范围。结合range_min使用，只会获取 range_min 与 range_max 之间的数据。</li>
</ul>
<p>~output_frame_id(str, default: camera_depth_frame)</p>
<ul>
<li>激光信息的ID。</li>
</ul>
<h4 id="3-depthimage-to-laserscan使用"><a href="#3-depthimage-to-laserscan使用" class="headerlink" title="3.depthimage_to_laserscan使用"></a>3.depthimage_to_laserscan使用</h4><h5 id="3-1编写launch文件"><a href="#3-1编写launch文件" class="headerlink" title="3.1编写launch文件"></a>3.1编写launch文件</h5><p>编写launch文件执行，将深度信息转换成雷达信息</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">launch</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">&quot;depthimage_to_laserscan&quot;</span> <span class="attr">type</span>=<span class="string">&quot;depthimage_to_laserscan&quot;</span> <span class="attr">name</span>=<span class="string">&quot;depthimage_to_laserscan&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">remap</span> <span class="attr">from</span>=<span class="string">&quot;image&quot;</span> <span class="attr">to</span>=<span class="string">&quot;/camera/depth/image_raw&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;output_frame_id&quot;</span> <span class="attr">value</span>=<span class="string">&quot;camera&quot;</span>  /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">node</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">launch</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>订阅的话题需要根据深度相机发布的话题设置，output_frame_id需要与深度相机的坐标系一致。</p>
<h5 id="3-2修改URDF文件"><a href="#3-2修改URDF文件" class="headerlink" title="3.2修改URDF文件"></a>3.2修改URDF文件</h5><p>经过信息转换之后，深度相机也将发布雷达数据，为了不产生混淆，可以注释掉 xacro 文件中的关于激光雷达的部分内容。</p>
<h5 id="3-3执行-1"><a href="#3-3执行-1" class="headerlink" title="3.3执行"></a>3.3执行</h5><p>1.启动gazebo仿真环境，如下:</p>


<p>2.启动rviz并添加相关组件(image、LaserScan)，结果如下:</p>
<h4 id="4-SLAM应用"><a href="#4-SLAM应用" class="headerlink" title="4.SLAM应用"></a>4.SLAM应用</h4><p>现在我们已经实现并测试通过深度图像信息转换成激光雷达信息了，接下来是实践阶段，通过深度相机实现SLAM，流程如下:</p>
<p>1.先启动 Gazebo 仿真环境；</p>
<p>2.启动转换节点；</p>
<p>3.再启动地图绘制的 launch 文件；</p>
<p>4.启动键盘键盘控制节点，用于控制机器人运动建图；</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rosrun teleop_twist_keyboard teleop_twist_keyboard.py</span><br></pre></td></tr></table></figure>

<p>5.在 rviz  中添加组件，显示栅格地图最后，就可以通过键盘控制gazebo中的机器人运动，同时，在rviz中可以显示gmapping发布的栅格地图数据了，但是，前面也介绍了，由于精度和检测范围的原因，尤其再加之环境的特征点偏少，建图效果可能并不理想，建图中甚至会出现地图偏移的情况。</p>
<h2 id="7-4-本章小结"><a href="#7-4-本章小结" class="headerlink" title="7.4 本章小结"></a>7.4 本章小结</h2><p>本章介绍了在仿真环境下的机器人导航实现，主要内容如下:</p>
<ul>
<li>导航概念以及架构设计</li>
<li>SLAM概念以及gmapping实现</li>
<li>地图的序列化与反序列化</li>
<li>定位实现</li>
<li>路径规划实现</li>
<li>导航中涉及的消息解释</li>
</ul>
<p>导航整体设计架构中，包含地图、定位、路径规划、感知以及控制等实现，感知与控制模块在上一章机器人系统仿真中已经实现了，因此没有做过多介绍，其他部分，当前也是基于仿真环境实现的，后续，我们将搭建一台实体机器人并实现导航功能。</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="http://inzeroworld.com.cn">Zero</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="http://inzeroworld.com.cn/2024/03/20/U7_%E6%9C%BA%E5%99%A8%E4%BA%BA%E5%AF%BC%E8%88%AA%EF%BC%88%E4%BB%BF%E7%9C%9F%EF%BC%89/">http://inzeroworld.com.cn/2024/03/20/U7_%E6%9C%BA%E5%99%A8%E4%BA%BA%E5%AF%BC%E8%88%AA%EF%BC%88%E4%BB%BF%E7%9C%9F%EF%BC%89/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://inzeroworld.com.cn" target="_blank">In Zero's World</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/ROS/">ROS</a></div><div class="post_share"><div class="social-share" data-image="https://s2.loli.net/2024/01/01/6KrPmZeSJzgTxFC.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-full"><a href="/2024/03/20/U6_%E6%9C%BA%E5%99%A8%E4%BA%BA%E7%B3%BB%E7%BB%9F%E4%BB%BF%E7%9C%9F/" title="U6_机器人系统仿真"><img class="cover" src="https://s2.loli.net/2024/01/01/6KrPmZeSJzgTxFC.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">U6_机器人系统仿真</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2024/03/05/2024-03-03/" title="智能赛组会 2024-03-03"><img class="cover" src="https://s2.loli.net/2024/01/01/5aAzeSl942kDdWn.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-03-05</div><div class="title">智能赛组会 2024-03-03</div></div></a></div><div><a href="/2024/01/08/Aviator410/" title="Aviator410 - auto_takeoff"><img class="cover" src="https://s2.loli.net/2024/01/01/POjnvHT7tAQDb6u.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-01-08</div><div class="title">Aviator410 - auto_takeoff</div></div></a></div><div><a href="/2024/02/21/ROS%E8%AF%BE%E7%A8%8B%E5%A4%A7%E7%BA%B2-1/" title="ROS课程大纲"><img class="cover" src="https://s2.loli.net/2024/01/01/6KrPmZeSJzgTxFC.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-02-21</div><div class="title">ROS课程大纲</div></div></a></div><div><a href="/2024/02/21/U1_/" title="U1_ ROS概述与环境搭建"><img class="cover" src="https://s2.loli.net/2024/01/01/6KrPmZeSJzgTxFC.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-02-21</div><div class="title">U1_ ROS概述与环境搭建</div></div></a></div><div><a href="/2024/02/21/U2-ROS%E9%80%9A%E8%AE%AF%E6%9C%BA%E5%88%B6/" title="U2_ROS通讯机制"><img class="cover" src="https://s2.loli.net/2024/01/01/6KrPmZeSJzgTxFC.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-02-21</div><div class="title">U2_ROS通讯机制</div></div></a></div><div><a href="/2024/02/25/U4-ROS%E8%BF%90%E8%A1%8C%E7%AE%A1%E7%90%86/" title="U4_ROS运行管理"><img class="cover" src="https://s2.loli.net/2024/01/01/6KrPmZeSJzgTxFC.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-02-25</div><div class="title">U4_ROS运行管理</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://s2.loli.net/2024/03/06/DdFmuoWIlGbg6fU.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Zero</div><div class="author-info__description">去见证世间的美好</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">33</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">5</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">4</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/KiCola"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC-7-%E7%AB%A0-%E6%9C%BA%E5%99%A8%E4%BA%BA%E5%AF%BC%E8%88%AA-%E4%BB%BF%E7%9C%9F"><span class="toc-number">1.</span> <span class="toc-text">第 7 章 机器人导航(仿真)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#7-1-%E6%A6%82%E8%BF%B0"><span class="toc-number">1.1.</span> <span class="toc-text">7.1 概述</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E6%A6%82%E5%BF%B5"><span class="toc-number">1.1.0.1.</span> <span class="toc-text">1.概念</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E4%BD%9C%E7%94%A8"><span class="toc-number">1.1.0.2.</span> <span class="toc-text">2.作用</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-1-1%E5%AF%BC%E8%88%AA%E6%A8%A1%E5%9D%97%E7%AE%80%E4%BB%8B"><span class="toc-number">1.1.1.</span> <span class="toc-text">7.1.1导航模块简介</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%85%A8%E5%B1%80%E5%9C%B0%E5%9B%BE"><span class="toc-number">1.1.1.1.</span> <span class="toc-text">1.全局地图</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E8%87%AA%E8%BA%AB%E5%AE%9A%E4%BD%8D"><span class="toc-number">1.1.1.2.</span> <span class="toc-text">2.自身定位</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E8%B7%AF%E5%BE%84%E8%A7%84%E5%88%92"><span class="toc-number">1.1.1.3.</span> <span class="toc-text">3.路径规划</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E8%BF%90%E5%8A%A8%E6%8E%A7%E5%88%B6"><span class="toc-number">1.1.1.4.</span> <span class="toc-text">4.运动控制</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-%E7%8E%AF%E5%A2%83%E6%84%9F%E7%9F%A5"><span class="toc-number">1.1.1.5.</span> <span class="toc-text">5.环境感知</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-1-2-%E5%AF%BC%E8%88%AA%E4%B9%8B%E5%9D%90%E6%A0%87%E7%B3%BB"><span class="toc-number">1.1.2.</span> <span class="toc-text">7.1.2 导航之坐标系</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E7%AE%80%E4%BB%8B"><span class="toc-number">1.1.2.1.</span> <span class="toc-text">1.简介</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E7%89%B9%E7%82%B9"><span class="toc-number">1.1.2.2.</span> <span class="toc-text">2.特点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E5%9D%90%E6%A0%87%E7%B3%BB%E5%8F%98%E6%8D%A2"><span class="toc-number">1.1.2.3.</span> <span class="toc-text">3.坐标系变换</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-1-3%E5%AF%BC%E8%88%AA%E6%9D%A1%E4%BB%B6%E8%AF%B4%E6%98%8E"><span class="toc-number">1.1.3.</span> <span class="toc-text">7.1.3导航条件说明</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E7%A1%AC%E4%BB%B6"><span class="toc-number">1.1.3.1.</span> <span class="toc-text">1.硬件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E8%BD%AF%E4%BB%B6"><span class="toc-number">1.1.3.2.</span> <span class="toc-text">2.软件</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-2-%E5%AF%BC%E8%88%AA%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.2.</span> <span class="toc-text">7.2 导航实现</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#7-2-1-%E5%AF%BC%E8%88%AA%E5%AE%9E%E7%8E%B001-SLAM%E5%BB%BA%E5%9B%BE"><span class="toc-number">1.2.1.</span> <span class="toc-text">7.2.1 导航实现01_SLAM建图</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-gmapping%E7%AE%80%E4%BB%8B"><span class="toc-number">1.2.1.1.</span> <span class="toc-text">1.gmapping简介</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-gmapping%E8%8A%82%E7%82%B9%E8%AF%B4%E6%98%8E"><span class="toc-number">1.2.1.2.</span> <span class="toc-text">2.gmapping节点说明</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#2-1%E8%AE%A2%E9%98%85%E7%9A%84Topic"><span class="toc-number">1.2.1.2.1.</span> <span class="toc-text">2.1订阅的Topic</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-2%E5%8F%91%E5%B8%83%E7%9A%84Topic"><span class="toc-number">1.2.1.2.2.</span> <span class="toc-text">2.2发布的Topic</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-3%E6%9C%8D%E5%8A%A1"><span class="toc-number">1.2.1.2.3.</span> <span class="toc-text">2.3服务</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-4%E5%8F%82%E6%95%B0"><span class="toc-number">1.2.1.2.4.</span> <span class="toc-text">2.4参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-5%E6%89%80%E9%9C%80%E7%9A%84%E5%9D%90%E6%A0%87%E5%8F%98%E6%8D%A2"><span class="toc-number">1.2.1.2.5.</span> <span class="toc-text">2.5所需的坐标变换</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-6%E5%8F%91%E5%B8%83%E7%9A%84%E5%9D%90%E6%A0%87%E5%8F%98%E6%8D%A2"><span class="toc-number">1.2.1.2.6.</span> <span class="toc-text">2.6发布的坐标变换</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-gmapping%E4%BD%BF%E7%94%A8"><span class="toc-number">1.2.1.3.</span> <span class="toc-text">3.gmapping使用</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#3-1%E7%BC%96%E5%86%99gmapping%E8%8A%82%E7%82%B9%E7%9B%B8%E5%85%B3launch%E6%96%87%E4%BB%B6"><span class="toc-number">1.2.1.3.1.</span> <span class="toc-text">3.1编写gmapping节点相关launch文件</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-2%E6%89%A7%E8%A1%8C"><span class="toc-number">1.2.1.3.2.</span> <span class="toc-text">3.2执行</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-2-2-%E5%AF%BC%E8%88%AA%E5%AE%9E%E7%8E%B002-%E5%9C%B0%E5%9B%BE%E6%9C%8D%E5%8A%A1"><span class="toc-number">1.2.2.</span> <span class="toc-text">7.2.2 导航实现02_地图服务</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-map-server%E7%AE%80%E4%BB%8B"><span class="toc-number">1.2.2.1.</span> <span class="toc-text">1.map_server简介</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-map-server%E4%BD%BF%E7%94%A8%E4%B9%8B%E5%9C%B0%E5%9B%BE%E4%BF%9D%E5%AD%98%E8%8A%82%E7%82%B9-map-saver"><span class="toc-number">1.2.2.2.</span> <span class="toc-text">2.map_server使用之地图保存节点(map_saver)</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#2-1map-saver%E8%8A%82%E7%82%B9%E8%AF%B4%E6%98%8E"><span class="toc-number">1.2.2.2.1.</span> <span class="toc-text">2.1map_saver节点说明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-2%E5%9C%B0%E5%9B%BE%E4%BF%9D%E5%AD%98launch%E6%96%87%E4%BB%B6"><span class="toc-number">1.2.2.2.2.</span> <span class="toc-text">2.2地图保存launch文件</span></a></li><li class="toc-item toc-level-5"><a class="toc-link"><span class="toc-number">1.2.2.2.3.</span> <span class="toc-text"></span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-3-%E4%BF%9D%E5%AD%98%E7%BB%93%E6%9E%9C%E8%A7%A3%E9%87%8A"><span class="toc-number">1.2.2.2.4.</span> <span class="toc-text">2.3 保存结果解释</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-map-server%E4%BD%BF%E7%94%A8%E4%B9%8B%E5%9C%B0%E5%9B%BE%E6%9C%8D%E5%8A%A1-map-server"><span class="toc-number">1.2.2.3.</span> <span class="toc-text">3.map_server使用之地图服务(map_server)</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#3-1map-server%E8%8A%82%E7%82%B9%E8%AF%B4%E6%98%8E"><span class="toc-number">1.2.2.3.1.</span> <span class="toc-text">3.1map_server节点说明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-2%E5%9C%B0%E5%9B%BE%E8%AF%BB%E5%8F%96"><span class="toc-number">1.2.2.3.2.</span> <span class="toc-text">3.2地图读取</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-3%E5%9C%B0%E5%9B%BE%E6%98%BE%E7%A4%BA"><span class="toc-number">1.2.2.3.3.</span> <span class="toc-text">3.3地图显示</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-2-3-%E5%AF%BC%E8%88%AA%E5%AE%9E%E7%8E%B003-%E5%AE%9A%E4%BD%8D"><span class="toc-number">1.2.3.</span> <span class="toc-text">7.2.3 导航实现03_定位</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-amcl%E7%AE%80%E4%BB%8B"><span class="toc-number">1.2.3.1.</span> <span class="toc-text">1.amcl简介</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-amcl%E8%8A%82%E7%82%B9%E8%AF%B4%E6%98%8E"><span class="toc-number">1.2.3.2.</span> <span class="toc-text">2.amcl节点说明</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#3-1%E8%AE%A2%E9%98%85%E7%9A%84Topic"><span class="toc-number">1.2.3.2.1.</span> <span class="toc-text">3.1订阅的Topic</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-2%E5%8F%91%E5%B8%83%E7%9A%84Topic"><span class="toc-number">1.2.3.2.2.</span> <span class="toc-text">3.2发布的Topic</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-3%E6%9C%8D%E5%8A%A1"><span class="toc-number">1.2.3.2.3.</span> <span class="toc-text">3.3服务</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-4%E8%B0%83%E7%94%A8%E7%9A%84%E6%9C%8D%E5%8A%A1"><span class="toc-number">1.2.3.2.4.</span> <span class="toc-text">3.4调用的服务</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-5%E5%8F%82%E6%95%B0"><span class="toc-number">1.2.3.2.5.</span> <span class="toc-text">3.5参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-6%E5%9D%90%E6%A0%87%E5%8F%98%E6%8D%A2"><span class="toc-number">1.2.3.2.6.</span> <span class="toc-text">3.6坐标变换</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-amcl%E4%BD%BF%E7%94%A8"><span class="toc-number">1.2.3.3.</span> <span class="toc-text">3.amcl使用</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#3-1%E7%BC%96%E5%86%99amcl%E8%8A%82%E7%82%B9%E7%9B%B8%E5%85%B3%E7%9A%84launch%E6%96%87%E4%BB%B6"><span class="toc-number">1.2.3.3.1.</span> <span class="toc-text">3.1编写amcl节点相关的launch文件</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-2%E7%BC%96%E5%86%99%E6%B5%8B%E8%AF%95launch%E6%96%87%E4%BB%B6"><span class="toc-number">1.2.3.3.2.</span> <span class="toc-text">3.2编写测试launch文件</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-3%E6%89%A7%E8%A1%8C"><span class="toc-number">1.2.3.3.3.</span> <span class="toc-text">3.3执行</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-2-4-%E5%AF%BC%E8%88%AA%E5%AE%9E%E7%8E%B004-%E8%B7%AF%E5%BE%84%E8%A7%84%E5%88%92"><span class="toc-number">1.2.4.</span> <span class="toc-text">7.2.4 导航实现04_路径规划</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-move-base%E7%AE%80%E4%BB%8B"><span class="toc-number">1.2.4.1.</span> <span class="toc-text">1.move_base简介</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-move-base%E8%8A%82%E7%82%B9%E8%AF%B4%E6%98%8E"><span class="toc-number">1.2.4.2.</span> <span class="toc-text">2.move_base节点说明</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#2-1%E5%8A%A8%E4%BD%9C"><span class="toc-number">1.2.4.2.1.</span> <span class="toc-text">2.1动作</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-2%E8%AE%A2%E9%98%85%E7%9A%84Topic"><span class="toc-number">1.2.4.2.2.</span> <span class="toc-text">2.2订阅的Topic</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-3%E5%8F%91%E5%B8%83%E7%9A%84Topic"><span class="toc-number">1.2.4.2.3.</span> <span class="toc-text">2.3发布的Topic</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-4%E6%9C%8D%E5%8A%A1"><span class="toc-number">1.2.4.2.4.</span> <span class="toc-text">2.4服务</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-5%E5%8F%82%E6%95%B0"><span class="toc-number">1.2.4.2.5.</span> <span class="toc-text">2.5参数</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-move-base%E4%B8%8E%E4%BB%A3%E4%BB%B7%E5%9C%B0%E5%9B%BE"><span class="toc-number">1.2.4.3.</span> <span class="toc-text">3.move_base与代价地图</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#3-1%E6%A6%82%E5%BF%B5"><span class="toc-number">1.2.4.3.1.</span> <span class="toc-text">3.1概念</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-2%E7%BB%84%E6%88%90"><span class="toc-number">1.2.4.3.2.</span> <span class="toc-text">3.2组成</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-3%E7%A2%B0%E6%92%9E%E7%AE%97%E6%B3%95"><span class="toc-number">1.2.4.3.3.</span> <span class="toc-text">3.3碰撞算法</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-move-base%E4%BD%BF%E7%94%A8"><span class="toc-number">1.2.4.4.</span> <span class="toc-text">4.move_base使用</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#4-1launch%E6%96%87%E4%BB%B6"><span class="toc-number">1.2.4.4.1.</span> <span class="toc-text">4.1launch文件</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-2%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">1.2.4.4.2.</span> <span class="toc-text">4.2配置文件</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#4-2-1costmap-common-params-yaml"><span class="toc-number">1.2.4.4.2.1.</span> <span class="toc-text">4.2.1costmap_common_params.yaml</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#-1"><span class="toc-number">1.2.4.4.2.2.</span> <span class="toc-text"></span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#4-2-2global-costmap-params-yaml"><span class="toc-number">1.2.4.4.2.3.</span> <span class="toc-text">4.2.2global_costmap_params.yaml</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#4-2-3local-costmap-params-yaml"><span class="toc-number">1.2.4.4.2.4.</span> <span class="toc-text">4.2.3local_costmap_params.yaml</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#4-2-4base-local-planner-params"><span class="toc-number">1.2.4.4.2.5.</span> <span class="toc-text">4.2.4base_local_planner_params</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#4-2-5%E5%8F%82%E6%95%B0%E9%85%8D%E7%BD%AE%E6%8A%80%E5%B7%A7"><span class="toc-number">1.2.4.4.2.6.</span> <span class="toc-text">4.2.5参数配置技巧</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-3launch%E6%96%87%E4%BB%B6%E9%9B%86%E6%88%90"><span class="toc-number">1.2.4.4.3.</span> <span class="toc-text">4.3launch文件集成</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-4%E6%B5%8B%E8%AF%95"><span class="toc-number">1.2.4.4.4.</span> <span class="toc-text">4.4测试</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-2-5-%E5%AF%BC%E8%88%AA%E4%B8%8ESLAM%E5%BB%BA%E5%9B%BE"><span class="toc-number">1.2.5.</span> <span class="toc-text">7.2.5 导航与SLAM建图</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E7%BC%96%E5%86%99launc%E6%96%87%E4%BB%B6"><span class="toc-number">1.2.5.1.</span> <span class="toc-text">1.编写launc文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E6%B5%8B%E8%AF%95"><span class="toc-number">1.2.5.2.</span> <span class="toc-text">2.测试</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-3-%E5%AF%BC%E8%88%AA%E7%9B%B8%E5%85%B3%E6%B6%88%E6%81%AF"><span class="toc-number">1.3.</span> <span class="toc-text">7.3 导航相关消息</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#7-3-1-%E5%AF%BC%E8%88%AA%E4%B9%8B%E5%9C%B0%E5%9B%BE"><span class="toc-number">1.3.1.</span> <span class="toc-text">7.3.1 导航之地图</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-nav-msgs-MapMetaData"><span class="toc-number">1.3.1.1.</span> <span class="toc-text">1.nav_msgs&#x2F;MapMetaData</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-nav-msgs-OccupancyGrid"><span class="toc-number">1.3.1.2.</span> <span class="toc-text">2.nav_msgs&#x2F;OccupancyGrid</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-3-2-%E5%AF%BC%E8%88%AA%E4%B9%8B%E9%87%8C%E7%A8%8B%E8%AE%A1"><span class="toc-number">1.3.2.</span> <span class="toc-text">7.3.2 导航之里程计</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-3-3-%E5%AF%BC%E8%88%AA%E4%B9%8B%E5%9D%90%E6%A0%87%E5%8F%98%E6%8D%A2"><span class="toc-number">1.3.3.</span> <span class="toc-text">7.3.3 导航之坐标变换</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-3-4-%E5%AF%BC%E8%88%AA%E4%B9%8B%E5%AE%9A%E4%BD%8D"><span class="toc-number">1.3.4.</span> <span class="toc-text">7.3.4 导航之定位</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-3-5-%E5%AF%BC%E8%88%AA%E4%B9%8B%E7%9B%AE%E6%A0%87%E7%82%B9%E4%B8%8E%E8%B7%AF%E5%BE%84%E8%A7%84%E5%88%92"><span class="toc-number">1.3.5.</span> <span class="toc-text">7.3.5 导航之目标点与路径规划</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-3-6-%E5%AF%BC%E8%88%AA%E4%B9%8B%E6%BF%80%E5%85%89%E9%9B%B7%E8%BE%BE"><span class="toc-number">1.3.6.</span> <span class="toc-text">7.3.6 导航之激光雷达</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-3-7-%E5%AF%BC%E8%88%AA%E4%B9%8B%E7%9B%B8%E6%9C%BA"><span class="toc-number">1.3.7.</span> <span class="toc-text">7.3.7 导航之相机</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-3-5-%E6%B7%B1%E5%BA%A6%E5%9B%BE%E5%83%8F%E8%BD%AC%E6%BF%80%E5%85%89%E6%95%B0%E6%8D%AE"><span class="toc-number">1.3.8.</span> <span class="toc-text">7.3.5 深度图像转激光数据</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-depthimage-to-laserscan%E7%AE%80%E4%BB%8B"><span class="toc-number">1.3.8.1.</span> <span class="toc-text">1.depthimage_to_laserscan简介</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1%E5%8E%9F%E7%90%86"><span class="toc-number">1.3.8.1.1.</span> <span class="toc-text">1.1原理</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-2%E4%BC%98%E7%BC%BA%E7%82%B9"><span class="toc-number">1.3.8.1.2.</span> <span class="toc-text">1.2优缺点</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-3%E5%AE%89%E8%A3%85"><span class="toc-number">1.3.8.1.3.</span> <span class="toc-text">1.3安装</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-depthimage-to-laserscan%E8%8A%82%E7%82%B9%E8%AF%B4%E6%98%8E"><span class="toc-number">1.3.8.2.</span> <span class="toc-text">2.depthimage_to_laserscan节点说明</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#2-1%E8%AE%A2%E9%98%85%E7%9A%84Topic-1"><span class="toc-number">1.3.8.2.1.</span> <span class="toc-text">2.1订阅的Topic</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-2%E5%8F%91%E5%B8%83%E7%9A%84Topic-1"><span class="toc-number">1.3.8.2.2.</span> <span class="toc-text">2.2发布的Topic</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-3%E5%8F%82%E6%95%B0"><span class="toc-number">1.3.8.2.3.</span> <span class="toc-text">2.3参数</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-depthimage-to-laserscan%E4%BD%BF%E7%94%A8"><span class="toc-number">1.3.8.3.</span> <span class="toc-text">3.depthimage_to_laserscan使用</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#3-1%E7%BC%96%E5%86%99launch%E6%96%87%E4%BB%B6"><span class="toc-number">1.3.8.3.1.</span> <span class="toc-text">3.1编写launch文件</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-2%E4%BF%AE%E6%94%B9URDF%E6%96%87%E4%BB%B6"><span class="toc-number">1.3.8.3.2.</span> <span class="toc-text">3.2修改URDF文件</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-3%E6%89%A7%E8%A1%8C-1"><span class="toc-number">1.3.8.3.3.</span> <span class="toc-text">3.3执行</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-SLAM%E5%BA%94%E7%94%A8"><span class="toc-number">1.3.8.4.</span> <span class="toc-text">4.SLAM应用</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-4-%E6%9C%AC%E7%AB%A0%E5%B0%8F%E7%BB%93"><span class="toc-number">1.4.</span> <span class="toc-text">7.4 本章小结</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2024/03/20/U7_%E6%9C%BA%E5%99%A8%E4%BA%BA%E5%AF%BC%E8%88%AA%EF%BC%88%E4%BB%BF%E7%9C%9F%EF%BC%89/" title="U7_机器人导航（仿真）"><img src="https://s2.loli.net/2024/01/01/6KrPmZeSJzgTxFC.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="U7_机器人导航（仿真）"/></a><div class="content"><a class="title" href="/2024/03/20/U7_%E6%9C%BA%E5%99%A8%E4%BA%BA%E5%AF%BC%E8%88%AA%EF%BC%88%E4%BB%BF%E7%9C%9F%EF%BC%89/" title="U7_机器人导航（仿真）">U7_机器人导航（仿真）</a><time datetime="2024-03-20T12:10:40.000Z" title="发表于 2024-03-20 20:10:40">2024-03-20</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/03/20/U6_%E6%9C%BA%E5%99%A8%E4%BA%BA%E7%B3%BB%E7%BB%9F%E4%BB%BF%E7%9C%9F/" title="U6_机器人系统仿真"><img src="https://s2.loli.net/2024/01/01/6KrPmZeSJzgTxFC.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="U6_机器人系统仿真"/></a><div class="content"><a class="title" href="/2024/03/20/U6_%E6%9C%BA%E5%99%A8%E4%BA%BA%E7%B3%BB%E7%BB%9F%E4%BB%BF%E7%9C%9F/" title="U6_机器人系统仿真">U6_机器人系统仿真</a><time datetime="2024-03-20T12:00:40.000Z" title="发表于 2024-03-20 20:00:40">2024-03-20</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/03/18/ML-%E5%88%86%E7%B1%BB-1_%E9%B8%A2%E5%B0%BE%E8%8A%B1%E5%88%86%E7%B1%BB/" title="ML-分类-1_鸢尾花分类"><img src="https://s2.loli.net/2024/01/01/Vq7ZHcQ5zyKGbX2.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="ML-分类-1_鸢尾花分类"/></a><div class="content"><a class="title" href="/2024/03/18/ML-%E5%88%86%E7%B1%BB-1_%E9%B8%A2%E5%B0%BE%E8%8A%B1%E5%88%86%E7%B1%BB/" title="ML-分类-1_鸢尾花分类">ML-分类-1_鸢尾花分类</a><time datetime="2024-03-18T11:32:32.271Z" title="发表于 2024-03-18 19:32:32">2024-03-18</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/03/14/%E6%99%BA%E8%83%BD%E8%B5%9B%E8%AE%BE%E5%A4%87%E7%BB%BC%E8%BF%B0/" title="智能赛技术实现前期综述"><img src="https://s2.loli.net/2024/01/01/5aAzeSl942kDdWn.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="智能赛技术实现前期综述"/></a><div class="content"><a class="title" href="/2024/03/14/%E6%99%BA%E8%83%BD%E8%B5%9B%E8%AE%BE%E5%A4%87%E7%BB%BC%E8%BF%B0/" title="智能赛技术实现前期综述">智能赛技术实现前期综述</a><time datetime="2024-03-13T16:00:00.000Z" title="发表于 2024-03-14 00:00:00">2024-03-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/03/05/%E6%A2%A6%E5%8D%81%E5%9B%9B%E6%94%AF%E6%95%99%E6%97%A5%E8%AE%B0-final/" title="梦十四支教日记-final"><img src="https://s2.loli.net/2024/03/05/5rhqM4ZyCtYNfAb.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="梦十四支教日记-final"/></a><div class="content"><a class="title" href="/2024/03/05/%E6%A2%A6%E5%8D%81%E5%9B%9B%E6%94%AF%E6%95%99%E6%97%A5%E8%AE%B0-final/" title="梦十四支教日记-final">梦十四支教日记-final</a><time datetime="2024-03-05T13:17:10.000Z" title="发表于 2024-03-05 21:17:10">2024-03-05</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://s2.loli.net/2024/01/01/6KrPmZeSJzgTxFC.png')"><div id="footer-wrap"><div class="copyright">&copy;2018 - 2024 By Zero</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">in Zero's world</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=4.12.0"></script><script src="/js/main.js?v=4.12.0"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.32/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"></div><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>